"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[7862],{87862:(e,s,t)=>{t.r(s),t.d(s,{IDocumentProviderFactory:()=>o,ProviderMock:()=>n,WebSocketProvider:()=>R});class n{destroy(){}setPath(e){}get renameAck(){return Promise.resolve(!1)}}var c=t(74547);const o=new c.Token("@jupyterlab/docprovider:IDocumentProviderFactory");var a=t(66962),i=t(34571),r=t(25796),h=t(22592),d=t(47941),l=t(83149);const u=new Map,w="undefined"==typeof BroadcastChannel?class{constructor(e){this.room=e,this.onmessage=null,l.z((s=>s.key===e&&null!==this.onmessage&&this.onmessage({data:d.Gh(s.newValue||"")})))}postMessage(e){l.X.setItem(this.room,d.s3(d.eh(e)))}}:BroadcastChannel,f=e=>h.Yu(u,e,(()=>{const s=new Set,t=new w(e);return t.onmessage=e=>s.forEach((s=>s(e.data,"broadcastchannel"))),{bc:t,subs:s}})),m=(e,s,t=null)=>{const n=f(e);n.bc.postMessage(s),n.subs.forEach((e=>e(s,t)))};var _=t(2431);const y=(e,s)=>{i.uE(e,0);const t=r.encodeStateVector(s);i.mP(e,t)},b=(e,s,t)=>{i.uE(e,1),i.mP(e,r.encodeStateAsUpdate(s,t))},p=(e,s,t)=>{try{r.applyUpdate(s,a.HN(e),t)}catch(e){console.error("Caught error while handling a Yjs update",e)}},g=p;var v=t(90157),U=t(12330),k=t(11182),E=t(36498),C=t(27061);const I=[];I[0]=(e,s,t,n,c)=>{i.uE(e,0);const o=((e,s,t,n)=>{const c=a.yg(e);switch(c){case 0:((e,s,t)=>{b(s,t,a.HN(e))})(e,s,t);break;case 1:p(e,t,n);break;case 2:g(e,t,n);break;default:throw new Error("Unknown message type")}return c})(s,e,t.doc,t);n&&1===o&&!t.synced&&(t.synced=!0)},I[3]=(e,s,t,n,c)=>{i.uE(e,1),i.mP(e,v.xq(t.awareness,Array.from(t.awareness.getStates().keys())))},I[1]=(e,s,t,n,c)=>{v.oy(t.awareness,a.HN(s),t)},I[2]=(e,s,t,n,c)=>{((e,s,t)=>{0===a.yg(e)&&t(s,a.kf(e))})(s,t.doc,M)};const M=(e,s)=>console.warn(`Permission denied to access ${e.url}.\n${s}`),P=(e,s,t)=>{const n=a.l1(s),c=i.Mf(),o=a.yg(n),r=e.messageHandlers[o];return r?r(c,n,e,t,o):console.error("Unable to compute message"),c},T=e=>{if(e.shouldConnect&&null===e.ws){const s=new e._WS(e.url);s.binaryType="arraybuffer",e.ws=s,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,s.onmessage=t=>{e.wsLastMessageReceived=_.ZG();const n=P(e,new Uint8Array(t.data),!0);i.kE(n)>1&&s.send(i._f(n))},s.onerror=s=>{e.emit("connection-error",[s,e])},s.onclose=s=>{e.emit("connection-close",[s,e]),e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,v.Ag(e.awareness,Array.from(e.awareness.getStates().keys()).filter((s=>s!==e.doc.clientID)),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(T,k.VV(100*k.sQ(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e)},s.onopen=()=>{e.wsLastMessageReceived=_.ZG(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const t=i.Mf();if(i.uE(t,0),y(t,e.doc),s.send(i._f(t)),null!==e.awareness.getLocalState()){const t=i.Mf();i.uE(t,1),i.mP(t,v.xq(e.awareness,[e.doc.clientID])),s.send(i._f(t))}},e.emit("status",[{status:"connecting"}])}},H=(e,s)=>{e.wsconnected&&e.ws.send(s),e.bcconnected&&m(e.bcChannel,s,e)};class B extends U.y{constructor(e,s,t,{connect:n=!0,awareness:c=new v.GL(t),params:o={},WebSocketPolyfill:a=WebSocket,resyncInterval:r=-1,maxBackoffTime:h=2500,disableBc:d=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);const l=(e=>E.UI(e,((e,s)=>`${encodeURIComponent(s)}=${encodeURIComponent(e)}`)).join("&"))(o);this.maxBackoffTime=h,this.bcChannel=e+"/"+s,this.url=e+"/"+s+(0===l.length?"":"?"+l),this.roomname=s,this.doc=t,this._WS=a,this.awareness=c,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=d,this.wsUnsuccessfulReconnects=0,this.messageHandlers=I.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=n,this._resyncInterval=0,r>0&&(this._resyncInterval=setInterval((()=>{if(this.ws){const e=i.Mf();i.uE(e,0),y(e,t),this.ws.send(i._f(e))}}),r)),this._bcSubscriber=(e,s)=>{if(s!==this){const s=P(this,new Uint8Array(e),!1);i.kE(s)>1&&m(this.bcChannel,i._f(s),this)}},this._updateHandler=(e,s)=>{if(s!==this){const s=i.Mf();i.uE(s,0),((e,s)=>{i.uE(e,2),i.mP(e,s)})(s,e),H(this,i._f(s))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:s,removed:t},n)=>{const o=e.concat(s).concat(t),a=i.Mf();i.uE(a,1),i.mP(a,v.xq(c,o)),H(this,i._f(a))},this._beforeUnloadHandler=()=>{v.Ag(this.awareness,[t.clientID],"window unload")},"undefined"!=typeof window?window.addEventListener("beforeunload",this._beforeUnloadHandler):void 0!==C&&C.on("exit",this._beforeUnloadHandler),c.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval((()=>{this.wsconnected&&3e4<_.ZG()-this.wsLastMessageReceived&&this.ws.close()}),3e3),n&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),"undefined"!=typeof window?window.removeEventListener("beforeunload",this._beforeUnloadHandler):void 0!==C&&C.off("exit",this._beforeUnloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;var e,s;this.bcconnected||(e=this.bcChannel,s=this._bcSubscriber,f(e).subs.add(s),this.bcconnected=!0);const t=i.Mf();i.uE(t,0),y(t,this.doc),m(this.bcChannel,i._f(t),this);const n=i.Mf();i.uE(n,0),b(n,this.doc),m(this.bcChannel,i._f(n),this);const c=i.Mf();i.uE(c,3),m(this.bcChannel,i._f(c),this);const o=i.Mf();i.uE(o,1),i.mP(o,v.xq(this.awareness,[this.doc.clientID])),m(this.bcChannel,i._f(o),this)}disconnectBc(){const e=i.Mf();var s,t;i.uE(e,1),i.mP(e,v.xq(this.awareness,[this.doc.clientID],new Map)),H(this,i._f(e)),this.bcconnected&&(s=this.bcChannel,t=this._bcSubscriber,f(s).subs.delete(t),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(T(this),this.connectBc())}}class R extends B{constructor(e){super(e.url,e.format+":"+e.contentType+":"+e.path,e.ymodel.ydoc,{awareness:e.ymodel.awareness}),this._path=e.path,this._contentType=e.contentType,this._format=e.format,this._serverUrl=e.url,this.messageHandlers[127]=(e,s,t,n,c)=>{this._renameAck.resolve(!!a.iU(s)[0])};const s=e.ymodel.awareness,t=e.user,n=()=>{const e=""!==t.displayName?t.displayName:t.name;s.setLocalStateField("user",Object.assign(Object.assign({},t.toJSON()),{name:e}))};t.isReady&&n(),t.ready.connect(n),t.changed.connect(n)}get renameAck(){return this._renameAck.promise}setPath(e){if(e!==this._path){this._path=e;const s=i.Mf();this._renameAck=new c.PromiseDelegate,i.cW(s,127);const t=unescape(encodeURIComponent(this._format+":"+this._contentType+":"+e));for(let e=0;e<t.length;e++)i.cW(s,t.codePointAt(e));this._sendMessage(i._f(s)),this.disconnectBc(),this.bcChannel=this._serverUrl+"/"+this._format+":"+this._contentType+":"+this._path,this.url=this.bcChannel,this.connectBc()}}_sendMessage(e){const s=()=>{setTimeout((()=>{this.wsconnected?this.ws.send(e):this.once("status",s)}),0)};s()}}}}]);