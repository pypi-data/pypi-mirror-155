"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[6999],{36999:(e,t,s)=>{s.r(t),s.d(t,{FOUND_CLASSES:()=>a,GenericSearchProvider:()=>h,HTMLSearchEngine:()=>c,ISearchProviderRegistry:()=>A,SearchDocumentModel:()=>m,SearchDocumentView:()=>O,SearchProvider:()=>i,SearchProviderRegistry:()=>k,TextSearchEngine:()=>l});var r=s(59985),n=s(58646);class i{constructor(e){this.widget=e,this._stateChanged=new n.Signal(this),this._disposed=!1}get stateChanged(){return this._stateChanged}get currentMatchIndex(){return null}get isDisposed(){return this._disposed}get matchesCount(){return null}dispose(){this._disposed||(this._disposed=!0,n.Signal.clearData(this))}getInitialQuery(){return""}getFilters(){return{}}}const a=["cm-string","cm-overlay","cm-searching"],o=["CodeMirror-selectedtext"];class c{static search(e,t){if(!(t instanceof Node))return console.warn("Unable to search with HTMLSearchEngine the provided object.",t),Promise.resolve([]);e.global||(e=new RegExp(e.source,e.flags+"g"));const s=[],r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:s=>{let r=s.parentElement;for(;r!==t;){if(r.nodeName in c.UNSUPPORTED_ELEMENTS)return NodeFilter.FILTER_REJECT;r=r.parentElement}return e.test(s.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let n=null;for(;null!==(n=r.nextNode());){e.lastIndex=0;let t=null;for(;null!==(t=e.exec(n.textContent));)s.push({text:t[0],position:t.index,node:n})}return Promise.resolve(s)}}c.UNSUPPORTED_ELEMENTS={BASE:!0,HEAD:!0,LINK:!0,META:!0,STYLE:!0,TITLE:!0,BODY:!0,AREA:!0,AUDIO:!0,IMG:!0,MAP:!0,TRACK:!0,VIDEO:!0,APPLET:!0,EMBED:!0,IFRAME:!0,NOEMBED:!0,OBJECT:!0,PARAM:!0,PICTURE:!0,SOURCE:!0,CANVAS:!0,NOSCRIPT:!0,SCRIPT:!0,SVG:!0};class h extends i{constructor(){super(...arguments),this.isReadOnly=!0,this._matches=[],this._mutationObserver=new MutationObserver(this._onWidgetChanged.bind(this)),this._markNodes=new Array}static isApplicable(e){return e instanceof r.Widget}static createNew(e,t,s){return new h(e)}get currentMatchIndex(){return this._currentMatchIndex>=0?this._currentMatchIndex:null}get currentMatch(){var e;return null!==(e=this._matches[this._currentMatchIndex])&&void 0!==e?e:null}get matches(){return this._matches?this._matches.map((e=>Object.assign({},e))):this._matches}get matchesCount(){return this._matches.length}clearHighlight(){return this._currentMatchIndex>=0&&this._markNodes[this._currentMatchIndex].classList.remove(...o),this._currentMatchIndex=-1,Promise.resolve()}dispose(){this.isDisposed||(this.endQuery().catch((e=>{console.error("Failed to end search query.",e)})),super.dispose())}async highlightNext(e){var t;return null!==(t=this._highlightNext(!1,null==e||e))&&void 0!==t?t:void 0}async highlightPrevious(e){var t;return null!==(t=this._highlightNext(!0,null==e||e))&&void 0!==t?t:void 0}async replaceCurrentMatch(e,t){return Promise.resolve(!1)}async replaceAllMatches(e){return Promise.resolve(!1)}async startQuery(e,t={}){if(await this.endQuery(),this._query=e,null===e)return Promise.resolve();const s=await c.search(e,this.widget.node);let r=0;for(;r<s.length;){let e=s[r].node,t=e.parentNode,n=[s[r]];for(;++r<s.length&&s[r].node===e;)n.unshift(s[r]);const i=n.map((s=>{const r=document.createElement("mark");r.classList.add(...a),r.textContent=s.text;const n=e.splitText(s.position);return n.textContent=n.textContent.slice(s.text.length),t.insertBefore(r,n),r}));for(let e=i.length-1;e>=0;e--)this._markNodes.push(i[e])}this._mutationObserver.observe(this.widget.node,{attributes:!1,characterData:!0,childList:!0,subtree:!0}),this._matches=s}async endQuery(){this._mutationObserver.disconnect(),this._markNodes.forEach((e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()})),this._markNodes=[],this._matches=[],this._currentMatchIndex=-1}_highlightNext(e,t){if(0===this._matches.length)return null;if(-1===this._currentMatchIndex?this._currentMatchIndex=e?this.matches.length-1:0:(this._markNodes[this._currentMatchIndex].classList.remove(...o),this._currentMatchIndex=e?this._currentMatchIndex-1:this._currentMatchIndex+1,t&&(this._currentMatchIndex<0||this._currentMatchIndex>=this._matches.length)&&(this._currentMatchIndex=(this._currentMatchIndex+this._matches.length)%this._matches.length)),this._currentMatchIndex>=0&&this._currentMatchIndex<this._matches.length){const t=this._markNodes[this._currentMatchIndex];return t.classList.add(...o),function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.left>=0&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(t)||t.scrollIntoView(e),t.focus(),this._matches[this._currentMatchIndex]}return this._currentMatchIndex=-1,null}async _onWidgetChanged(e,t){this._currentMatchIndex=-1,await this.startQuery(this._query),this._stateChanged.emit()}}const l={search(e,t){if("string"!=typeof t)try{t=JSON.stringify(t)}catch(e){return console.warn("Unable to search with TextSearchEngine non-JSON serializable object.",e,t),Promise.resolve([])}e.global||(e=new RegExp(e.source,e.flags+"g"));const s=new Array;let r=null;for(;null!==(r=e.exec(t));)s.push({text:r[0],position:r.index});return Promise.resolve(s)}};var p,d=s(43306),u=s(74547),g=s(6814);class m extends d.VDomModel{constructor(e,t){if(super(),this.searchProvider=e,this._caseSensitive=!1,this._disposed=new n.Signal(this),this._parsingError="",this._filters={},this._searchExpression="",this._useRegex=!1,this._filters={},this.searchProvider.getFilters){const e=this.searchProvider.getFilters();for(const t in e)this._filters[t]=e[t].default}e.stateChanged.connect(this.refresh,this),this._searchDebouncer=new g.Debouncer((()=>{this._updateSearch().catch((e=>{console.error("Failed to update search on document.",e)}))}),t)}get caseSensitive(){return this._caseSensitive}set caseSensitive(e){this._caseSensitive!==e&&(this._caseSensitive=e,this.stateChanged.emit(),this.refresh())}get currentIndex(){return this.searchProvider.currentMatchIndex}get disposed(){return this._disposed}get filters(){return this._filters}set filters(e){u.JSONExt.deepEqual(this._filters,e)||(this._filters=e,this.stateChanged.emit(),this.refresh())}get filtersDefinition(){var e,t,s;return null!==(s=null===(t=(e=this.searchProvider).getFilters)||void 0===t?void 0:t.call(e))&&void 0!==s?s:{}}get initialQuery(){return this._searchExpression||this.searchProvider.getInitialQuery()}get isReadOnly(){return this.searchProvider.isReadOnly}get parsingError(){return this._parsingError}get replaceText(){return this._replaceText}set replaceText(e){this._replaceText!==e&&(this._replaceText=e,this.stateChanged.emit())}get searchExpression(){return this._searchExpression}set searchExpression(e){this._searchExpression!==e&&(this._searchExpression=e,this.stateChanged.emit(),this.refresh())}get totalMatches(){return this.searchProvider.matchesCount}get useRegex(){return this._useRegex}set useRegex(e){this._useRegex!==e&&(this._useRegex=e,this.stateChanged.emit(),this.refresh())}dispose(){this.isDisposed||(this._searchExpression&&this.endQuery().catch((e=>{console.error(`Failed to end query '${this._searchExpression}.`,e)})),this.searchProvider.stateChanged.disconnect(this.refresh,this),this._searchDebouncer.dispose(),super.dispose())}async endQuery(){await this.searchProvider.endQuery(),this.stateChanged.emit()}async highlightNext(){await this.searchProvider.highlightNext(),this.stateChanged.emit()}async highlightPrevious(){await this.searchProvider.highlightPrevious(),this.stateChanged.emit()}refresh(){this._searchDebouncer.invoke().catch((e=>{console.error("Failed to invoke search document debouncer.",e)}))}async replaceAllMatches(){await this.searchProvider.replaceAllMatches(this._replaceText),this.stateChanged.emit()}async replaceCurrentMatch(){await this.searchProvider.replaceCurrentMatch(this._replaceText),this.stateChanged.emit()}async _updateSearch(){this._parsingError&&(this._parsingError="",this.stateChanged.emit());try{const e=this.searchExpression?p.parseQuery(this.searchExpression,this.caseSensitive,this.useRegex):null;e&&(await this.searchProvider.startQuery(e,this._filters),this.stateChanged.emit())}catch(e){this._parsingError=e,this.stateChanged.emit(),console.error(`Failed to parse expression ${this.searchExpression}`,e)}}}!function(e){e.parseQuery=function(e,t,s){const r=t?"g":"gi",n=s?e:e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");let i;return i=new RegExp(n,r),i.test("")?null:i}}(p||(p={}));var _=s(96936),x=s(72245);const E="jp-DocumentSearch-overlay-row",v="jp-DocumentSearch-input-button-off",f="jp-DocumentSearch-input-button-on",C="jp-DocumentSearch-up-down-button",R="jp-DocumentSearch-replace-button",S="jp-DocumentSearch-replace-button-wrapper",b="jp-DocumentSearch-button-content",y="jp-DocumentSearch-button-wrapper";function I(e){var t;const s=(null!==(t=e.translator)&&void 0!==t?t:_.nullTranslator).load("jupyterlab"),r=(0,d.classes)(e.caseSensitive?f:v,b),n=(0,d.classes)(e.useRegex?f:v,b);return x.createElement("div",{className:"jp-DocumentSearch-input-wrapper"},x.createElement("input",{placeholder:s.__("Find"),className:"jp-DocumentSearch-input",value:e.searchText,onChange:t=>e.onChange(t),onKeyDown:t=>e.onKeydown(t),tabIndex:0,ref:e.inputRef,title:s.__("Find")}),x.createElement("button",{className:y,onClick:()=>{e.onCaseSensitiveToggled()},tabIndex:0,title:s.__("Match Case")},x.createElement(d.caseSensitiveIcon.react,{className:r,tag:"span"})),x.createElement("button",{className:y,onClick:()=>e.onRegexToggled(),tabIndex:0,title:s.__("Use Regular Expression")},x.createElement(d.regexIcon.react,{className:n,tag:"span"})))}function N(e){var t;const s=(null!==(t=e.translator)&&void 0!==t?t:_.nullTranslator).load("jupyterlab");return x.createElement("div",{className:"jp-DocumentSearch-replace-wrapper-class"},x.createElement("input",{placeholder:s.__("Replace"),className:"jp-DocumentSearch-replace-entry",value:e.replaceText,onKeyDown:t=>e.onReplaceKeydown(t),onChange:t=>e.onChange(t),tabIndex:0,title:s.__("Replace")}),x.createElement("button",{className:S,onClick:()=>e.onReplaceCurrent(),tabIndex:0},x.createElement("span",{className:`${R} ${b}`,tabIndex:0},s.__("Replace"))),x.createElement("button",{className:S,tabIndex:0,onClick:()=>e.onReplaceAll()},x.createElement("span",{className:`${R} ${b}`,tabIndex:-1},s.__("Replace All"))))}function T(e){return x.createElement("div",{className:"jp-DocumentSearch-up-down-wrapper"},x.createElement("button",{className:y,onClick:()=>e.onHighlightPrevious(),tabIndex:0,title:e.trans.__("Previous Match")},x.createElement(d.caretUpEmptyThinIcon.react,{className:(0,d.classes)(C,b),tag:"span"})),x.createElement("button",{className:y,onClick:()=>e.onHighlightNext(),tabIndex:0,title:e.trans.__("Next Match")},x.createElement(d.caretDownEmptyThinIcon.react,{className:(0,d.classes)(C,b),tag:"span"})))}function w(e){return x.createElement("div",{className:"jp-DocumentSearch-index-counter"},0===e.totalMatches?"-/-":`${null===e.currentIndex?"-":e.currentIndex+1}/${e.totalMatches}`)}function M(e){let t=`jp-DocumentSearch-ellipses-button ${b}`;return e.enabled&&(t=`${t} jp-DocumentSearch-ellipses-button-enabled`),x.createElement("button",{className:y,onClick:()=>e.toggleEnabled(),tabIndex:0,title:e.enabled?e.trans.__("Hide Search Filters"):e.trans.__("Show Search Filters")},x.createElement(d.ellipsesIcon.react,{className:t,tag:"span",height:"20px",width:"20px"}))}function D(e){return x.createElement("label",{className:e.isEnabled?"":"jp-DocumentSearch-search-options-disabled",title:e.description},e.title,x.createElement("input",{type:"checkbox",disabled:!e.isEnabled,checked:e.value,onChange:e.onToggle}))}class P extends x.Component{constructor(e){super(e),this.translator=e.translator||_.nullTranslator,this.state={filtersOpen:!1}}_onSearchChange(e){const t=e.target.value;this.props.onSearchChanged(t)}_onSearchKeydown(e){13===e.keyCode?(e.preventDefault(),e.stopPropagation(),e.shiftKey?this.props.onHighlightPrevious():this.props.onHighlightNext()):27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this._onClose())}_onReplaceKeydown(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.props.onReplaceCurrent())}_onClose(){this.props.onClose()}_onReplaceToggled(){const e=Object.assign({},this.props.filters);if(!this.props.replaceEntryVisible)for(const t in this.props.filtersDefinition)this.props.filtersDefinition[t].supportReplace||(e[t]=!1);this.props.onFiltersChanged(e),this.props.onReplaceEntryShown(!this.props.replaceEntryVisible)}_toggleFiltersOpen(){this.setState((e=>({filtersOpen:!e.filtersOpen})))}render(){var e;const t=this.translator.load("jupyterlab"),s=!this.props.isReadOnly&&this.props.replaceEntryVisible,r=this.props.filtersDefinition,n=Object.keys(r).length>0,i=n?x.createElement(M,{enabled:this.state.filtersOpen,toggleEnabled:()=>this._toggleFiltersOpen(),trans:t}):null,a=n?x.createElement("div",{className:"jp-DocumentSearch-search-options"},Object.keys(r).map((e=>{var t;const n=r[e];return x.createElement(D,{key:e,title:n.title,description:n.description,isEnabled:!s||n.supportReplace,onToggle:()=>{const t={};t[e]=!this.props.filters[e],this.props.onFiltersChanged(t)},value:null!==(t=this.props.filters[e])&&void 0!==t?t:n.default})}))):null,o=this.props.replaceEntryVisible?d.caretDownIcon:d.caretRightIcon;return x.createElement(x.Fragment,null,x.createElement("div",{className:E},this.props.isReadOnly?x.createElement("div",{className:"jp-DocumentSearch-toggle-placeholder"}):x.createElement("button",{className:"jp-DocumentSearch-toggle-wrapper",onClick:()=>this._onReplaceToggled(),tabIndex:0,title:t.__("Toggle Replace")},x.createElement(o.react,{className:`jp-DocumentSearch-replace-toggle ${b}`,tag:"span",elementPosition:"center",height:"20px",width:"20px"})),x.createElement(I,{inputRef:this.props.searchInputRef,useRegex:this.props.useRegex,caseSensitive:this.props.caseSensitive,onCaseSensitiveToggled:this.props.onCaseSensitiveToggled,onRegexToggled:this.props.onRegexToggled,onKeydown:e=>this._onSearchKeydown(e),onChange:e=>this._onSearchChange(e),searchText:this.props.searchText,translator:this.translator}),x.createElement(w,{currentIndex:this.props.currentIndex,totalMatches:null!==(e=this.props.totalMatches)&&void 0!==e?e:0}),x.createElement(T,{onHighlightPrevious:()=>{this.props.onHighlightPrevious()},onHighlightNext:()=>{this.props.onHighlightNext()},trans:t}),s?null:i,x.createElement("button",{className:y,onClick:()=>this._onClose(),tabIndex:0},x.createElement(d.closeIcon.react,{className:"jp-icon-hover",elementPosition:"center",height:"16px",width:"16px"}))),x.createElement("div",{className:E},s?x.createElement(x.Fragment,null,x.createElement(N,{onReplaceKeydown:e=>this._onReplaceKeydown(e),onChange:e=>this.props.onReplaceChanged(e.target.value),onReplaceCurrent:()=>this.props.onReplaceCurrent(),onReplaceAll:()=>this.props.onReplaceAll(),replaceText:this.props.replaceText,translator:this.translator}),x.createElement("div",{className:"jp-DocumentSearch-spacer"}),i):null),this.state.filtersOpen?a:null,!!this.props.errorMessage&&x.createElement("div",{className:"jp-DocumentSearch-regex-error"},this.props.errorMessage),x.createElement("div",{className:"jp-DocumentSearch-document-loading"},t.__("This document is still loading. Only loaded content will appear in search results until the entire document loads.")))}}class O extends d.VDomRenderer{constructor(e,t){super(e),this.translator=t,this._showReplace=!1,this._closed=new n.Signal(this),this.addClass("jp-DocumentSearch-overlay"),this._searchInput=x.createRef()}get closed(){return this._closed}focusSearchInput(){var e;null===(e=this._searchInput.current)||void 0===e||e.select()}setSearchText(e){this.model.searchExpression=e}setReplaceText(e){this.model.replaceText=e}showReplace(){this.setReplaceInputVisibility(!0)}setReplaceInputVisibility(e){this._showReplace!==e&&(this._showReplace=e,this.update())}render(){return x.createElement(P,{caseSensitive:this.model.caseSensitive,currentIndex:this.model.currentIndex,isReadOnly:this.model.isReadOnly,errorMessage:this.model.parsingError,filters:this.model.filters,filtersDefinition:this.model.filtersDefinition,replaceEntryVisible:this._showReplace,replaceText:this.model.replaceText,searchText:this.model.searchExpression,searchInputRef:this._searchInput,totalMatches:this.model.totalMatches,translator:this.translator,useRegex:this.model.useRegex,onCaseSensitiveToggled:()=>{this.model.caseSensitive=!this.model.caseSensitive},onRegexToggled:()=>{this.model.useRegex=!this.model.useRegex},onFiltersChanged:e=>{this.model.filters=Object.assign(Object.assign({},this.model.filters),e)},onHighlightNext:()=>{this.model.highlightNext()},onHighlightPrevious:()=>{this.model.highlightPrevious()},onSearchChanged:e=>{this.model.searchExpression=e},onClose:async()=>{r.Widget.detach(this),this._closed.emit(),await this.model.endQuery()},onReplaceEntryShown:e=>{this.setReplaceInputVisibility(e)},onReplaceChanged:e=>{this.model.replaceText=e},onReplaceCurrent:()=>{this.model.replaceCurrentMatch()},onReplaceAll:()=>{this.model.replaceAllMatches()}})}}var j=s(18108);class k{constructor(e=_.nullTranslator){this.translator=e,this._changed=new n.Signal(this),this._providerMap=new Map}add(e,t){return this._providerMap.set(e,t),this._changed.emit(),new j.DisposableDelegate((()=>{this._providerMap.delete(e),this._changed.emit()}))}getProvider(e){for(const t of this._providerMap.values())if(t.isApplicable(e))return t.createNew(e,this.translator)}hasProvider(e){for(const t of this._providerMap.values())if(t.isApplicable(e))return!0;return!1}get changed(){return this._changed}}const A=new u.Token("@jupyterlab/documentsearch:ISearchProviderRegistry")}}]);