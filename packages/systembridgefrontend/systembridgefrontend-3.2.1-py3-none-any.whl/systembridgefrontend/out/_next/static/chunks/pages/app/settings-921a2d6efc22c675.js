(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{4768:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/settings",function(){return t(9992)}])},6771:function(e,n,t){"use strict";t.d(n,{Z:function(){return w}});var i=t(5893),r=t(7294),o=t(1163),a=t(9008),s=t.n(a),c=t(8298),l=t(2734),u=t(2293),d=t(9520),p=t(155),f=t(6886),h=t(3321),g=t(5861),m=t(7357);function y(e){var n=e.children,t=(0,c.Z)({disableHysteresis:!0,threshold:24});return(0,r.cloneElement)(n,{elevation:t?4:0})}var v=function(){var e=(0,r.useState)(!1),n=e[0],t=e[1],o=((0,r.useCallback)((function(){t(!n)}),[n]),(0,l.Z)());return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(y,{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{color:"transparent",elevation:0,children:(0,i.jsx)(d.Z,{maxWidth:"xl",sx:{padding:0},children:(0,i.jsx)(p.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,i.jsx)(f.ZP,{item:!0,children:(0,i.jsx)(h.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,i.jsx)(g.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:o.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,i.jsx)(m.Z,{sx:{height:o.spacing(18)}})]})})})};function x(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),i.forEach((function(n){x(e,n,t[n])}))}return e}var j=!1;var w=function(e){var n=(0,o.useRouter)();return(0,r.useEffect)((function(){if(n.isReady&&!j){var e,t,i,r;j=!0;var o=(null===(e=n.query)||void 0===e?void 0:e.apiKey)||"",a=(null===(t=n.query)||void 0===t?void 0:t.apiPort)||"9170",s=!1;if((null===(i=n.query)||void 0===i?void 0:i.apiKey)||(s=!0,o=window.prompt("Please enter your API key",o)),(null===(r=n.query)||void 0===r?void 0:r.apiPort)||(s=!0,a=window.prompt("Please enter your API port (default: 9170)",a)),s&&o&&a){var c=n.asPath.split("?")[0];n.replace({pathname:c.includes(".html")?c:"".concat(c,".html"),query:b({},n.query,{apiKey:o,apiPort:a})})}}}),[n]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s(),{children:[(0,i.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,i.jsx)("link",{rel:"canonical",href:e.url}),(0,i.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,i.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,i.jsx)(v,{}),e.children]})}},9375:function(e,n,t){"use strict";t.d(n,{C:function(){return s}});var i=t(4051),r=t.n(i);function o(e,n,t,i,r,o,a){try{var s=e[o](a),c=s.value}catch(l){return void t(l)}s.done?n(c):Promise.resolve(c).then(i,r)}function a(e){return function(){var n=this,t=arguments;return new Promise((function(i,r){var a=e.apply(n,t);function s(e){o(a,i,r,s,c,"next",e)}function c(e){o(a,i,r,s,c,"throw",e)}s(void 0)}))}}var s=function(){function e(n,t,i){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.port=n||9170,this.apiKey=t;var o=this;a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.connect();case 2:o.websocket=e.sent,i&&o.websocket&&o.websocket.readyState===o.websocket.OPEN&&i();case 4:case"end":return e.stop()}}),e)})))()}var n=e.prototype;return n.close=function(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()},n.connect=function(){var e=this;return a(r().mark((function n(){var t;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(e.port,"/api/websocket")),n.next=3,new Promise((function(e){t.onopen=function(){return e()}}));case 3:return t.onmessage=function(n){if("string"===typeof n.data){var t=JSON.parse(n.data);t&&e.onEvent&&e.onEvent(t)}},n.abrupt("return",t);case 5:case"end":return n.stop()}}),n)})))()},n.getData=function(e){this.websocket&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({event:"GET_DATA","api-key":this.apiKey,modules:e})))},n.getSettings=function(){this.websocket&&(console.log("Get settings"),this.websocket.send(JSON.stringify({event:"GET_SETTINGS","api-key":this.apiKey})))},n.registerDataListener=function(e){this.websocket&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({event:"REGISTER_DATA_LISTENER","api-key":this.apiKey,modules:e})))},n.sendEvent=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({event:"events",data:{"api-key":this.apiKey,data:e}}))},n.updateSetting=function(e,n){this.websocket&&(console.log("Update setting:",{key:e,value:n}),this.websocket.send(JSON.stringify({event:"UPDATE_SETTING","api-key":this.apiKey,setting:e,value:n})))},e}()},9992:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Y}});var i=t(5893),r=t(7294),o=t(9520),a=t(6771),s=t(4051),c=t.n(s),l=t(2734),u=t(6886),d=t(8456),p=t(1163),f=t(5317),h=t(7262),g=t(9375),m=t(5934),y=t(8619),v=t(9294),x=t(796),b=t(9953),j=t(3395),w=t(9653),k=t(4054),Z=t(7709),S=t(7109),P=t(3946),O=t(1713),C=t(699),E=t(8849);var I=t(8396),A=t(657),N=t(7645),_=t(8951),T=t(6514),D=t(8462),R=t(1425),G=t(3321),W=t(6486),z=t.n(W);var K=function(e){var n=e.setting,t=e.listIn,o=e.open,a=e.setOpen,s=e.handleChanged,c=(0,r.useState)([]),d=c[0],p=c[1],h=n.name,g=n.description,m=n.icon;(0,r.useEffect)((function(){!o&&t&&p(t)}),[t,o]);var j=(0,l.Z)(),w=(0,I.Z)(j.breakpoints.down("md"));return(0,i.jsxs)(A.Z,{fullScreen:w,fullWidth:!0,maxWidth:"lg",open:o,scroll:"paper",PaperProps:{style:{background:j.palette.background.paper}},children:[(0,i.jsxs)(N.Z,{children:[(0,i.jsx)(E.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.7,path:m,style:{marginRight:j.spacing(1)}}),h]}),(0,i.jsx)(_.Z,{sx:{margin:j.spacing(0,3)},children:g}),(0,i.jsx)(T.Z,{children:(0,i.jsxs)(D.Z,{children:[d.map((function(e,n){return(0,i.jsx)(v.ZP,{children:(0,i.jsxs)(u.ZP,{container:!0,alignItems:"center",children:[(0,i.jsx)(u.ZP,{item:!0,xs:4,sx:{marginRight:j.spacing(1)},children:(0,i.jsx)(C.Z,{id:"name",label:"Name",fullWidth:!0,variant:"outlined",value:e.name,onChange:function(e){var t=z().cloneDeep(d);console.log("Update name:",n,t,t[n]),t&&t[n]&&(t[n].name=e.target.value,p(t))}})}),(0,i.jsx)(u.ZP,{item:!0,xs:!0,sx:{marginLeft:j.spacing(1)},children:(0,i.jsx)(C.Z,{id:"value",label:"Value",fullWidth:!0,variant:"outlined",value:e.value,onChange:function(e){var t=z().cloneDeep(d);console.log("Update value:",n,t,t[n]),t&&t[n]&&(t[n].value=e.target.value,p(t))}})}),(0,i.jsx)(u.ZP,{item:!0,children:(0,i.jsx)(P.Z,{"aria-label":"Remove",size:"large",onClick:function(){var e=z().cloneDeep(d);e.splice(n,1),p(e)},children:(0,i.jsx)(E.Icon,{id:"remove-item",title:"Remove",size:.8,path:f.S6N})})})]})},n)})),(0,i.jsxs)(y.Z,{onClick:function(){var e=z().cloneDeep(d);e.push({name:"",value:""}),p(e)},children:[(0,i.jsx)(x.Z,{children:(0,i.jsx)(E.Icon,{id:"add",title:"Add",size:1,path:f.qX5})}),(0,i.jsx)(b.Z,{primary:"Add",secondary:"Add a new item"})]})]})}),(0,i.jsxs)(R.Z,{children:[(0,i.jsx)(G.Z,{onClick:function(){a(!1)},color:"primary",variant:"outlined",children:"Cancel"}),(0,i.jsx)(G.Z,{onClick:function(){a(!1),s(d.sort((function(e,n){return e.name.localeCompare(n.name)})))},color:"primary",variant:"outlined",children:"Save"})]})]})};function q(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var L=function(e){var n=e.keyIn,t=e.valueIn,o=e.handleChanged,a=function(e){_(e)},s=function(e){a(e.target.value)},c=(0,r.useState)(!1),d=c[0],p=c[1],h=(0,r.useState)(!1),g=h[0],I=h[1],A=(0,r.useState)(t),N=A[0],_=A[1],T=(0,r.useMemo)((function(){return t!==N}),[t,N]),D=$[n],R=D.name,G=D.description,W=D.icon,z=D.containerDisabled,L=D.isList,F=D.isPassword,U=D.minimum,B=(0,l.Z)(),J=function(e){var n=e.children;return L?(0,i.jsx)(y.Z,{onClick:function(){return p(!0)},children:n}):(0,i.jsx)(v.ZP,{children:n})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(J,{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsx)(E.Icon,{id:"icon",title:R,size:1,path:W})}),(0,i.jsx)(b.Z,{primary:R,secondary:G,sx:{maxWidth:"64%",userSelect:"none"}}),(0,i.jsx)(j.Z,{sx:{width:420,textAlign:"end"},children:(0,i.jsxs)(u.ZP,{container:!0,alignItems:"center",justifyContent:"flex-end",children:[(0,i.jsx)(u.ZP,{item:!0,children:"boolean"===typeof N?(0,i.jsx)(w.Z,{edge:"end",disabled:z,checked:N,onChange:function(e,n){a(n)}}):"string"===typeof t&&"api_key"===n?(0,i.jsx)(k.Z,{fullWidth:!0,variant:"outlined",children:(0,i.jsx)(Z.Z,{type:"text",disabled:!0,value:N,endAdornment:(0,i.jsxs)(S.Z,{position:"end",children:[(0,i.jsx)(P.Z,{"aria-label":"Generate Api Key",onClick:function(){a((0,m.Z)())},edge:"end",size:"large",sx:{margin:B.spacing(-1,-.5)},children:(0,i.jsx)(E.Icon,{id:"generate-api-key",title:"Generate API Key",size:1,path:f.VmU})}),(0,i.jsx)(P.Z,{"aria-label":"Copy to clipboard",onClick:function(){return e=String(N),void navigator.permissions.query({name:"clipboard-write"}).then((function(n){"granted"!==n.state&&"prompt"!==n.state||navigator.clipboard.writeText(e)}));var e},size:"large",sx:{margin:B.spacing(-1,-.5)},children:(0,i.jsx)(E.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.8,path:f.a0Z})})]})})}):"string"===typeof t&&"string"===typeof N&&"log_level"===n?(0,i.jsx)(O.Z,{id:n,options:["DEBUG","INFO","WARNING","ERROR","CRITICAL"],renderInput:function(e){return(0,i.jsx)(C.Z,function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),i.forEach((function(n){q(e,n,t[n])}))}return e}({},e,{variant:"outlined"}))},onChange:function(e,n){n&&a(n)},sx:{width:210},value:N}):"string"===typeof t&&F?(0,i.jsx)(k.Z,{variant:"outlined",children:(0,i.jsx)(Z.Z,{type:g?"text":"password",defaultValue:N,onChange:s,endAdornment:(0,i.jsx)(S.Z,{position:"end",children:(0,i.jsx)(P.Z,{"aria-label":"Toggle visibility",onClick:function(){I(!g)},onMouseDown:function(e){e.preventDefault()},size:"large",children:(0,i.jsx)(E.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.8,path:g?f.rgx:f.DqW})})})})}):"string"===typeof t?(0,i.jsx)(C.Z,{type:"text",defaultValue:N,disabled:z,onChange:s,variant:"outlined"}):"number"===typeof t?(0,i.jsx)(C.Z,{error:!!U&&Number(N)<U,type:"number",disabled:z,inputProps:{minimum:U},defaultValue:N,onChange:s,variant:"outlined"}):""}),L?"":(0,i.jsx)(u.ZP,{item:!0,children:(0,i.jsx)(P.Z,{disabled:!1===T,onClick:function(){o(n,N)},sx:{margin:B.spacing(1)},children:(0,i.jsx)(E.Icon,{id:"save",title:"Save",size:1,path:f.JTj,style:{opacity:T?1:.25}})})})]})})]})}),L&&Array.isArray(N)?(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(K,{setting:$[n],listIn:N,open:d,setOpen:p,handleChanged:function(e){_(e),o(n,e)}})}):""]})},F=t(5861),U=t(5113);var B,J=function(e){var n=e.name,t=e.description,r=e.children;return(0,i.jsxs)(u.ZP,{container:!0,direction:"row",item:!0,xs:12,children:[(0,i.jsxs)(u.ZP,{item:!0,xs:4,style:{userSelect:"none"},children:[(0,i.jsx)(F.Z,{component:"h3",variant:"h5",children:n}),(0,i.jsx)(F.Z,{variant:"subtitle1",children:t})]}),(0,i.jsx)(u.ZP,{item:!0,xs:8,children:(0,i.jsx)(U.Z,{children:(0,i.jsx)(D.Z,{children:r})})})]})};function M(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function V(e,n,t,i,r,o,a){try{var s=e[o](a),c=s.value}catch(l){return void t(l)}s.done?n(c):Promise.resolve(c).then(i,r)}function H(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function X(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,o=[],a=!0,s=!1;try{for(t=t.call(e);!(a=(i=t.next()).done)&&(o.push(i.value),!n||o.length!==n);a=!0);}catch(c){s=!0,r=c}finally{try{a||null==t.return||t.return()}finally{if(s)throw r}}return o}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return M(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return M(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $={autostart:{name:"Autostart",description:"Automatically start the application on startup",icon:f.USr},log_level:{name:"Log Level",description:"Log level for the application",icon:f.eLz},port_api:{name:"API Port",description:"Port for the API and WebSocket",icon:f.A0p},additional_media_directories:{name:"Additional Media Directories",description:"Additional media directories for the media endpoint",icon:f.Rmq,isList:!0}};var Q=function(){var e=X((0,h.r)(),2),n=e[0],t=e[1],o=(0,r.useState)(!1),a=o[0],s=o[1],f=(0,p.useRouter)().query,m=(0,r.useCallback)((function(e){if(console.log("Event:",e),"SETTINGS_RESULT"===e.type){console.log("Settings result data:",e.data);var n={};console.log("settingsMap:",$);var i=Object.keys($);e.data.sort((function(e,n){return i.indexOf(e.key)>i.indexOf(n.key)?1:-1})).forEach((function(e){n[e.key]=e.value})),console.log("Settings:",n),t(n)}}),[t]),y=(0,r.useCallback)((function(e,n){var t;console.log("Setup WebSocketConnection"),B=new g.C(e,n,(t=c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.getSettings();case 1:case"end":return e.stop()}}),e)})),function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function a(e){V(o,i,r,a,s,"next",e)}function s(e){V(o,i,r,a,s,"throw",e)}a(void 0)}))})),B.onEvent=m}),[m]),v=(0,r.useCallback)((function(e,i){B.updateSetting(e,i),t(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},i=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),i.forEach((function(n){H(e,n,t[n])}))}return e}({},n,H({},e,i)))}),[n,t]);(0,r.useEffect)((function(){!a&&f&&f.apiKey&&(s(!0),y(Number(f.apiPort)||9170,String(f.apiKey)))}),[a,y,f]);var x=(0,l.Z)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(u.ZP,{container:!0,direction:"column",spacing:2,alignItems:"stretch",sx:{marginBottom:x.spacing(8),padding:x.spacing(2)},children:n?(0,i.jsx)(J,{name:"General",description:"General settings",children:(0,i.jsx)(i.Fragment,{children:Object.keys(n).map((function(e,t){return(0,i.jsx)(L,{keyIn:e,valueIn:n[e],handleChanged:v},t)}))})}):(0,i.jsx)(u.ZP,{container:!0,direction:"row",justifyContent:"center",sx:{margin:x.spacing(2,0,10)},children:(0,i.jsx)(d.Z,{})})})})};var Y=function(){return(0,i.jsx)(a.Z,{title:"Settings",url:"https://system-bridge.timmo.dev",description:"Frontend for System Bridge",children:(0,i.jsx)(o.Z,{component:"article",maxWidth:"xl",children:(0,i.jsx)(Q,{})})})}}},function(e){e.O(0,[662,702,291,316,699,713,767,208,774,888,179],(function(){return n=4768,e(e.s=n);var n}));var n=e.O();_N_E=n}]);