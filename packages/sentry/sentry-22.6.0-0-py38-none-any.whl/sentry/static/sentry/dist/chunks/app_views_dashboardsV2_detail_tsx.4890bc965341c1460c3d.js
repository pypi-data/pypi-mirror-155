"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_dashboardsV2_detail_tsx"],{"./app/views/dashboardsV2/detail.tsx":(t,e,a)=>{a.d(e,{Z:()=>lt});var i=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),d=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/core-js/modules/es.array.includes.js"),a("../node_modules/core-js/modules/es.string.replace.js"),a("../node_modules/react/index.js")),o=a("../node_modules/react-router/es/index.js"),n=a("../node_modules/lodash/cloneDeep.js"),r=a.n(n),h=a("../node_modules/lodash/isEqual.js"),l=a.n(h),p=a("../node_modules/lodash/omit.js"),c=a.n(p),u=a("./app/actionCreators/dashboards.tsx"),g=a("./app/actionCreators/indicator.tsx"),b=a("./app/actionCreators/modal.tsx"),m=a("./app/components/breadcrumbs.tsx"),w=a("./app/components/datePageFilter.tsx"),D=a("./app/components/environmentPageFilter.tsx"),Z=a("./app/components/hookOrDefault.tsx"),E=a("./app/components/layouts/thirds.tsx"),f=a("./app/components/modals/widgetViewerModal/utils.tsx"),v=a("./app/components/noProjectMessage.tsx"),y=a("./app/components/organizations/pageFilterBar.tsx"),S=a("./app/components/organizations/pageFilters/container.tsx"),x=a("./app/components/projectPageFilter.tsx"),W=a("./app/components/sentryDocumentTitle.tsx"),z=a("./app/locale.tsx"),I=a("./app/styles/organization.tsx"),C=a("./app/styles/space.tsx"),P=a("./app/utils.tsx"),_=a("./app/utils/analytics.tsx"),R=a("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),L=a("./app/utils/withApi.tsx"),V=a("./app/utils/withOrganization.tsx"),A=a("./app/views/dashboardsV2/widgetViewer/widgetViewerContext.tsx"),N=a("./app/components/acl/feature.tsx"),U=a("./app/components/acl/featureDisabled.tsx"),k=a("./app/components/button.tsx"),B=a("./app/components/buttonBar.tsx"),T=a("./app/components/confirm.tsx"),$=a("./app/components/hovercard.tsx"),q=a("./app/components/tooltip.tsx"),M=a("./app/icons/index.tsx"),j=a("./app/views/dashboardsV2/types.tsx"),H=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function X(t){let{organization:e,dashboardState:a,dashboards:i,widgetLimitReached:d,onEdit:o,onCommit:n,onDelete:r,onCancel:h,onAddWidget:l}=t;function p(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,z.t)("Cancel");return(0,H.tZ)(k.ZP,{"data-test-id":"dashboard-cancel",onClick:t=>{t.preventDefault(),h()},children:t})}return[j.n3.EDIT,j.n3.PENDING_DELETE].includes(a)?(0,H.BX)(G,{gap:1,children:[p(),(0,H.tZ)(T.Z,{priority:"danger",message:(0,z.t)("Are you sure you want to delete this dashboard?"),onConfirm:r,disabled:i.length<=1,children:(0,H.tZ)(k.ZP,{"data-test-id":"dashboard-delete",priority:"danger",children:(0,z.t)("Delete")})}),(0,H.tZ)(k.ZP,{"data-test-id":"dashboard-commit",onClick:t=>{t.preventDefault(),n()},priority:"primary",children:(0,z.t)("Save and Finish")})]},"edit-controls"):a===j.n3.CREATE?(0,H.BX)(G,{gap:1,children:[p(),(0,H.tZ)(k.ZP,{"data-test-id":"dashboard-commit",onClick:t=>{t.preventDefault(),n()},priority:"primary",children:(0,z.t)("Save and Finish")})]},"create-controls"):a===j.n3.PREVIEW?(0,H.BX)(G,{gap:1,children:[p((0,z.t)("Go Back")),(0,H.tZ)(k.ZP,{"data-test-id":"dashboard-commit",onClick:t=>{t.preventDefault(),n()},priority:"primary",children:(0,z.t)("Add Dashboard")})]},"preview-controls"):(0,H.tZ)(G,{gap:1,children:(0,H.tZ)(F,{children:t=>(0,H.BX)(s.Fragment,{children:[(0,H.tZ)(k.ZP,{"data-test-id":"dashboard-edit",onClick:t=>{t.preventDefault(),o()},icon:(0,H.tZ)(M.yl,{}),disabled:!t,priority:"default",children:(0,z.t)("Edit Dashboard")}),t?(0,H.tZ)(q.Z,{title:(0,z._N)("Max widgets ([maxWidgets]) per dashboard reached.",{maxWidgets:j.ZU}),disabled:!d,children:(0,H.tZ)(k.ZP,{"data-test-id":"add-widget-library",priority:"primary",disabled:d,icon:(0,H.tZ)(M.N_,{isCircled:!0}),onClick:()=>{(0,R.Z)("dashboards_views.widget_library.opened",{organization:e}),l()},children:(0,z.t)("Add Widget")})}):null]})})},"controls")}X.displayName="Controls";const F=t=>{let{children:e}=t;return(0,H.tZ)(N.Z,{hookName:"feature-disabled:dashboards-edit",features:["organizations:dashboards-edit"],renderDisabled:t=>(0,H.tZ)($.uI,{body:(0,H.tZ)(U.Z,{features:t.features,hideHelpToggle:!0,featureName:(0,z.t)("Dashboard Editing")}),children:t.children(t)}),children:t=>{let{hasFeature:a}=t;return e(a)}})};F.displayName="DashboardEditFeature";const G=(0,d.Z)(B.ZP,{target:"e78awt50"})("@media (max-width: ",(t=>t.theme.breakpoints.small),"){grid-auto-flow:row;grid-row-gap:",(0,C.Z)(1),";width:100%;}"),O=X;var K=a("./app/views/dashboardsV2/dashboard.tsx"),Y=a("./app/views/dashboardsV2/data.tsx"),J=a("./app/views/dashboardsV2/layoutUtils.tsx"),Q=a("./app/components/editableText.tsx");function tt(t){let{dashboard:e,isEditing:a,onUpdate:i}=t;return(0,H.tZ)("div",{children:e?(0,H.tZ)(Q.Z,{isDisabled:!a,value:e.title,onChange:t=>i({...e,title:t}),errorMessage:(0,z.t)("Please set a title for this dashboard"),autoSelect:!0}):(0,z.t)("Dashboards")})}tt.displayName="DashboardTitle";const et=tt;var at=a("./app/views/dashboardsV2/utils.tsx");const it=(0,z.t)("You have unsaved changes, are you sure you want to leave?"),dt=(0,Z.Z)({hookName:"component:dashboards-header"});class st extends s.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{dashboardState:this.props.initialState,modifiedDashboard:this.updateModifiedDashboard(this.props.initialState),widgetLimitReached:this.props.dashboard.widgets.length>=j.ZU,setData:t=>{this.setState(t)}}),(0,i.Z)(this,"onEdit",(()=>{const{dashboard:t}=this.props;(0,_.ec)({eventKey:"dashboards2.edit.start",eventName:"Dashboards2: Edit start",organization_id:parseInt(this.props.organization.id,10)}),this.setState({dashboardState:j.n3.EDIT,modifiedDashboard:(0,at.qk)(t)})})),(0,i.Z)(this,"onRouteLeave",(()=>{const{dashboard:t}=this.props,{modifiedDashboard:e}=this.state;if(![j.n3.VIEW,j.n3.PENDING_DELETE,j.n3.PREVIEW].includes(this.state.dashboardState)&&!l()(e,t))return it})),(0,i.Z)(this,"onUnload",(t=>{const{dashboard:e}=this.props,{modifiedDashboard:a}=this.state;[j.n3.VIEW,j.n3.PENDING_DELETE,j.n3.PREVIEW].includes(this.state.dashboardState)||l()(a,e)||(t.preventDefault(),t.returnValue=it)})),(0,i.Z)(this,"onDelete",(t=>()=>{const{api:e,organization:a,location:i}=this.props;if(null==t||!t.id)return;const d=this.state.dashboardState;this.setState({dashboardState:j.n3.PENDING_DELETE},(()=>{(0,u.iM)(e,a.slug,t.id).then((()=>{(0,g.S9)((0,z.t)("Dashboard deleted")),(0,_.ec)({eventKey:"dashboards2.delete",eventName:"Dashboards2: Delete",organization_id:parseInt(this.props.organization.id,10)}),o.browserHistory.replace({pathname:`/organizations/${a.slug}/dashboards/`,query:i.query})})).catch((()=>{this.setState({dashboardState:d})}))}))})),(0,i.Z)(this,"onCancel",(()=>{const{organization:t,dashboard:e,location:a,params:i}=this.props,{modifiedDashboard:d}=this.state;let s=!l()(d,e);if(e.widgets.every((t=>{let{layout:e}=t;return!(0,P.ri)(e)}))&&(s=!l()({...d,widgets:null==d?void 0:d.widgets.map((t=>c()(t,"layout")))},{...e,widgets:e.widgets.map((t=>c()(t,"layout")))})),!s||this.isPreview||confirm(it)){if(i.dashboardId)return(0,_.ec)({eventKey:"dashboards2.edit.cancel",eventName:"Dashboards2: Edit cancel",organization_id:parseInt(this.props.organization.id,10)}),void this.setState({dashboardState:j.n3.VIEW,modifiedDashboard:null});(0,_.ec)({eventKey:"dashboards2.create.cancel",eventName:"Dashboards2: Create cancel",organization_id:parseInt(this.props.organization.id,10)}),o.browserHistory.replace({pathname:`/organizations/${t.slug}/dashboards/`,query:a.query})}})),(0,i.Z)(this,"handleUpdateWidgetList",(t=>{const{organization:e,dashboard:a,api:i,onDashboardUpdate:d,location:s}=this.props,{modifiedDashboard:n}=this.state,r=(0,J.RI)(t),h=(0,J.Sp)(r),l={...(0,at.qk)(n||a),widgets:(0,J._F)(t,h)};this.setState({modifiedDashboard:l,widgetLimitReached:t.length>=j.ZU}),this.isEditing||this.isPreview||(0,u.Y)(i,e.slug,l).then((t=>{d&&(d(t),this.setState({modifiedDashboard:null})),(0,g.S9)((0,z.t)("Dashboard updated")),a&&t.id!==a.id&&o.browserHistory.replace({pathname:`/organizations/${e.slug}/dashboard/${t.id}/`,query:{...s.query}})}),(()=>{}))})),(0,i.Z)(this,"handleAddCustomWidget",(t=>{const{dashboard:e}=this.props,{modifiedDashboard:a}=this.state,i=a||e;this.onUpdateWidget([...i.widgets,t])})),(0,i.Z)(this,"onAddWidget",(()=>{const{organization:t,dashboard:e,router:a,location:i,params:{dashboardId:d}}=this.props;this.setState({modifiedDashboard:(0,at.qk)(e)}),t.features.includes("new-widget-builder-experience-design")&&!t.features.includes("new-widget-builder-experience-modal-access")&&d?a.push({pathname:`/organizations/${t.slug}/dashboard/${d}/widget/new/`,query:{...i.query,source:j.EN.DASHBOARDS}}):(0,b.openAddDashboardWidgetModal)({organization:t,dashboard:e,onAddLibraryWidget:t=>this.handleUpdateWidgetList(t),source:j.EN.LIBRARY})})),(0,i.Z)(this,"onCommit",(()=>{const{api:t,organization:e,location:a,dashboard:i,onDashboardUpdate:d}=this.props,{modifiedDashboard:s,dashboardState:n}=this.state;switch(n){case j.n3.PREVIEW:case j.n3.CREATE:s&&(this.isPreview&&(0,R.Z)("dashboards_manage.templates.add",{organization:e,dashboard_id:i.id,dashboard_title:i.title,was_previewed:!0}),(0,u.JR)(t,e.slug,s,this.isPreview).then((t=>{(0,g.S9)((0,z.t)("Dashboard created")),(0,_.ec)({eventKey:"dashboards2.create.complete",eventName:"Dashboards2: Create complete",organization_id:parseInt(e.id,10)}),this.setState({dashboardState:j.n3.VIEW}),o.browserHistory.replace({pathname:`/organizations/${e.slug}/dashboard/${t.id}/`,query:{...a.query}})}),(()=>{})));break;case j.n3.EDIT:if(s)return l()(i,s)?void this.setState({dashboardState:j.n3.VIEW,modifiedDashboard:null}):void(0,u.Y)(t,e.slug,s).then((t=>{d&&d(t),(0,g.S9)((0,z.t)("Dashboard updated")),(0,_.ec)({eventKey:"dashboards2.edit.complete",eventName:"Dashboards2: Edit complete",organization_id:parseInt(e.id,10)}),this.setState({dashboardState:j.n3.VIEW,modifiedDashboard:null}),i&&t.id!==i.id&&o.browserHistory.replace({pathname:`/organizations/${e.slug}/dashboard/${t.id}/`,query:{...a.query}})}),(()=>{}));this.setState({dashboardState:j.n3.VIEW,modifiedDashboard:null});break;case j.n3.VIEW:default:this.setState({dashboardState:j.n3.VIEW,modifiedDashboard:null})}})),(0,i.Z)(this,"setModifiedDashboard",(t=>{this.setState({modifiedDashboard:t})})),(0,i.Z)(this,"onUpdateWidget",(t=>{this.setState((e=>({...e,widgetLimitReached:t.length>=j.ZU,modifiedDashboard:{...e.modifiedDashboard||this.props.dashboard,widgets:t}})))}))}componentDidMount(){const{route:t,router:e}=this.props;e.setRouteLeaveHook(t,this.onRouteLeave),window.addEventListener("beforeunload",this.onUnload),this.checkIfShouldMountWidgetViewerModal()}componentDidUpdate(t){this.checkIfShouldMountWidgetViewerModal(),t.initialState!==this.props.initialState&&this.setState({dashboardState:this.props.initialState})}componentWillUnmount(){window.removeEventListener("beforeunload",this.onUnload)}checkIfShouldMountWidgetViewerModal(){const{params:{widgetId:t,dashboardId:e},organization:a,dashboard:i,location:d,router:s}=this.props,{seriesData:o,tableData:n,issuesData:h,pageLinks:l,totalIssuesCount:p}=this.state;if((0,f.X)(d.pathname)){var u;const w=(0,P.ri)(t)&&(null!==(u=i.widgets.find((e=>{let{id:a}=e;return a===String(t)})))&&void 0!==u?u:i.widgets[t]);var m;w?((0,b.openWidgetViewerModal)({organization:a,widget:w,seriesData:o,tableData:n,issuesData:h,pageLinks:l,totalIssuesCount:p,onClose:()=>{const t=c()(d.query,Object.values(f.R));s.push({pathname:d.pathname.replace(/widget\/[0-9]+\/$/,""),query:t})},onEdit:()=>{if(a.features.includes("new-widget-builder-experience-design")&&!a.features.includes("new-widget-builder-experience-modal-access")){const t=i.widgets.indexOf(w);if(e)return void s.push({pathname:`/organizations/${a.slug}/dashboard/${e}/widget/${t}/edit/`,query:{...d.query,source:j.EN.DASHBOARDS}})}(0,b.openAddDashboardWidgetModal)({organization:a,widget:w,onUpdateWidget:t=>{const e=i.widgets.indexOf(w),a=r()(i.widgets);a[e]=t,this.handleUpdateWidgetList(a)},source:j.EN.DASHBOARDS})}}),(0,R.Z)("dashboards_views.widget_viewer.open",{organization:a,widget_type:null!==(m=w.widgetType)&&void 0!==m?m:j.l9.DISCOVER,display_type:w.displayType})):(s.replace({pathname:`/organizations/${a.slug}/dashboard/${i.id}/`,query:d.query}),(0,g.Iw)((0,z.t)("Widget not found")))}}updateModifiedDashboard(t){const{dashboard:e}=this.props;switch(t){case j.n3.PREVIEW:case j.n3.CREATE:case j.n3.EDIT:return(0,at.qk)(e);default:return null}}get isPreview(){const{dashboardState:t}=this.state;return j.n3.PREVIEW===t}get isEditing(){const{dashboardState:t}=this.state;return[j.n3.EDIT,j.n3.CREATE,j.n3.PENDING_DELETE].includes(t)}get isWidgetBuilderRouter(){const{location:t,params:e,organization:a}=this.props,{dashboardId:i,widgetIndex:d}=e;return[`/organizations/${a.slug}/dashboards/new/widget/new/`,`/organizations/${a.slug}/dashboard/${i}/widget/new/`,`/organizations/${a.slug}/dashboards/new/widget/${d}/edit/`,`/organizations/${a.slug}/dashboard/${i}/widget/${d}/edit/`].includes(t.pathname)}get dashboardTitle(){const{dashboard:t}=this.props,{modifiedDashboard:e}=this.state;return e?e.title:t.title}renderWidgetBuilder(){const{children:t,dashboard:e}=this.props,{modifiedDashboard:a}=this.state;return(0,s.isValidElement)(t)?(0,s.cloneElement)(t,{dashboard:null!=a?a:e,onSave:this.isEditing?this.onUpdateWidget:this.handleUpdateWidgetList}):t}renderDefaultDashboardDetail(){const{organization:t,dashboard:e,dashboards:a,params:i,router:d,location:s}=this.props,{modifiedDashboard:o,dashboardState:n,widgetLimitReached:r}=this.state,{dashboardId:h}=i;return(0,H.tZ)(S.Z,{hideGlobalHeader:!0,defaultSelection:{datetime:{start:null,end:null,utc:!1,period:Y.GY}},children:(0,H.tZ)(I.JH,{children:(0,H.BX)(v.Z,{organization:t,children:[(0,H.BX)(ot,{children:[(0,H.tZ)(nt,{children:(0,H.tZ)(et,{dashboard:null!=o?o:e,onUpdate:this.setModifiedDashboard,isEditing:this.isEditing})}),(0,H.tZ)(O,{organization:t,dashboards:a,onEdit:this.onEdit,onCancel:this.onCancel,onCommit:this.onCommit,onAddWidget:this.onAddWidget,onDelete:this.onDelete(e),dashboardState:n,widgetLimitReached:r})]}),(0,H.BX)(ht,{condensed:!0,children:[(0,H.tZ)(x.Z,{}),(0,H.tZ)(D.Z,{}),(0,H.tZ)(w.Z,{alignDropdown:"left"})]}),(0,H.tZ)(dt,{organization:t}),(0,H.tZ)(K.ZP,{paramDashboardId:h,dashboard:null!=o?o:e,organization:t,isEditing:this.isEditing,widgetLimitReached:r,onUpdate:this.onUpdateWidget,handleUpdateWidgetList:this.handleUpdateWidgetList,handleAddCustomWidget:this.handleAddCustomWidget,isPreview:this.isPreview,router:d,location:s})]})})})}getBreadcrumbLabel(){const{dashboardState:t}=this.state;let e=this.dashboardTitle;return t===j.n3.CREATE?e=(0,z.t)("Create Dashboard"):this.isPreview&&(e=(0,z.t)("Preview Dashboard")),e}renderDashboardDetail(){const{organization:t,dashboard:e,dashboards:a,params:i,router:d,location:s,newWidget:o,onSetNewWidget:n}=this.props,{modifiedDashboard:r,dashboardState:h,widgetLimitReached:l,seriesData:p,setData:c}=this.state,{dashboardId:u}=i;return(0,H.tZ)(W.Z,{title:e.title,orgSlug:t.slug,children:(0,H.tZ)(S.Z,{hideGlobalHeader:!0,defaultSelection:{datetime:{start:null,end:null,utc:!1,period:Y.GY}},children:(0,H.tZ)(rt,{children:(0,H.BX)(v.Z,{organization:t,children:[(0,H.BX)(E.h4,{children:[(0,H.BX)(E.oB,{children:[(0,H.tZ)(m.Z,{crumbs:[{label:(0,z.t)("Dashboards"),to:`/organizations/${t.slug}/dashboards/`},{label:this.getBreadcrumbLabel()}]}),(0,H.tZ)(E.Dx,{children:(0,H.tZ)(et,{dashboard:null!=r?r:e,onUpdate:this.setModifiedDashboard,isEditing:this.isEditing})})]}),(0,H.tZ)(E.kP,{children:(0,H.tZ)(O,{organization:t,dashboards:a,onEdit:this.onEdit,onCancel:this.onCancel,onCommit:this.onCommit,onAddWidget:this.onAddWidget,onDelete:this.onDelete(e),dashboardState:h,widgetLimitReached:l})})]}),(0,H.tZ)(E.uT,{children:(0,H.BX)(E.or,{fullWidth:!0,children:[(0,H.BX)(ht,{condensed:!0,children:[(0,H.tZ)(x.Z,{}),(0,H.tZ)(D.Z,{}),(0,H.tZ)(w.Z,{alignDropdown:"left"})]}),(0,H.tZ)(A.M.Provider,{value:{seriesData:p,setData:c},children:(0,H.tZ)(K.ZP,{paramDashboardId:u,dashboard:null!=r?r:e,organization:t,isEditing:this.isEditing,widgetLimitReached:l,onUpdate:this.onUpdateWidget,handleUpdateWidgetList:this.handleUpdateWidgetList,handleAddCustomWidget:this.handleAddCustomWidget,router:d,location:s,newWidget:o,onSetNewWidget:n,isPreview:this.isPreview})})]})})]})})})})}render(){const{organization:t}=this.props;return this.isWidgetBuilderRouter?this.renderWidgetBuilder():t.features.includes("dashboards-edit")?this.renderDashboardDetail():this.renderDefaultDashboardDetail()}}st.displayName="DashboardDetail";const ot=(0,d.Z)("div",{target:"e1anno2f3"})("display:grid;grid-template-columns:minmax(0, 1fr);grid-row-gap:",(0,C.Z)(2),";align-items:center;margin-bottom:",(0,C.Z)(2),";@media (min-width: ",(t=>t.theme.breakpoints.medium),"){grid-template-columns:minmax(0, 1fr) max-content;grid-column-gap:",(0,C.Z)(2),";height:40px;}"),nt=(0,d.Z)(E.Dx,{target:"e1anno2f2"})({name:"1i9vogi",styles:"margin-top:0"}),rt=(0,d.Z)(I.JH,{target:"e1anno2f1"})({name:"1hcx8jb",styles:"padding:0"}),ht=(0,d.Z)(y.Z,{target:"e1anno2f0"})("margin-bottom:",(0,C.Z)(2),";"),lt=(0,L.Z)((0,V.Z)(st))}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_detail_tsx.95b2ef1f47927eb3d7beb1fde5dc8cfd.js.map