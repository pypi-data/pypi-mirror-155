"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_traceDetails_traceView_tsx"],{"./app/utils/discover/discoverQuery.tsx":(e,t,r)=>{r.d(t,{Z:()=>l});var n=r("./app/utils/withApi.tsx"),s=r("./app/utils/discover/genericDiscoverQuery.tsx"),o=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function a(e){const t=e.useEvents?"events":"eventsv2",r=e.useEvents?(e,t)=>{var r;const{fields:n,...s}=null!==(r=e.meta)&&void 0!==r?r:{};return{...e,meta:{...n,...s}}}:void 0;return(0,o.tZ)(s.ZP,{route:t,shouldRefetchData:i,afterFetch:r,...e})}a.displayName="DiscoverQuery";const l=(0,n.Z)(a)},"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,r)=>{r.d(t,{AA:()=>m,ZP:()=>g,o:()=>p});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),o=r("./app/locale.tsx"),i=r("./app/utils/discover/eventView.tsx"),a=r("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=r("./app/views/organizationContext.tsx"),c=r("./app/utils/queryString.tsx"),d=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class p{constructor(e,t){(0,n.Z)(this,"message",void 0),(0,n.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class u extends s.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null}),(0,n.Z)(this,"_shouldRefetchData",(e=>{const t=this.getPayload(this.props),r=this.getPayload(e);return!(0,i.ze)(t,r)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,n.Z)(this,"_parseError",(e=>{var t;if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const r=null===(t=e.responseJSON)||void 0===t?void 0:t.detail;if("string"==typeof r)return new p(r,e);const n=null==r?void 0:r.message;return new p("string"==typeof n?n:(0,o.t)("An unknown error occurred."),e)})),(0,n.Z)(this,"fetchData",(async()=>{const{api:e,beforeFetch:t,afterFetch:r,didFetch:n,eventView:s,orgSlug:o,route:i,setError:a}=this.props;if(!s.isValid())return;const l=`/organizations/${o}/${i}/`,c=Symbol("tableFetchID"),d=this.getPayload(this.props);this.setState({isLoading:!0,tableFetchID:c}),null==a||a(void 0),null==t||t(e),e.clear();try{const[t,,s]=await m(e,l,d);if(this.state.tableFetchID!==c)return;const o=r?r(t,this.props):t;null==n||n(o),this.setState((e=>{var t;return{isLoading:!1,tableFetchID:void 0,error:null,pageLinks:null!==(t=null==s?void 0:s.getResponseHeader("Link"))&&void 0!==t?t:e.pageLinks,tableData:o}}))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),a&&a(null!=t?t:void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),r=!1===e.eventView.isValid()&&this.props.eventView.isValid(),n=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||r||n)&&this.fetchData()}getPayload(e){var t;const{cursor:r,limit:n,noPagination:s,referrer:o,location:i}=e,a=this.props.getRequestPayload?this.props.getRequestPayload(e):e.eventView.getEventsAPIPayload(e.location);if(r&&(a.cursor=r),n&&(a.per_page=n),s&&(a.noPagination=s),o&&(a.referrer=o),["events","eventsv2"].includes(e.route)){var l;const e=(0,c.ro)(null===(l=i.query)||void 0===l?void 0:l.userModified);void 0!==e&&(a.user_modified=e)}return Object.assign(a,null!==(t=e.queryExtras)&&void 0!==t?t:{}),a}render(){const{isLoading:e,error:t,tableData:r,pageLinks:n}=this.state,s={isLoading:e,error:t,tableData:r,pageLinks:n},o=this.props.children;return null==o?void 0:o(s)}}function h(e){var t,r,n,o;const i=null===(t=(0,s.useContext)(l.g))||void 0===t?void 0:t.slug,c=null===(r=(0,s.useContext)(a.uL))||void 0===r?void 0:r.eventView,p=null!==(n=e.orgSlug)&&void 0!==n?n:i,h=null!==(o=e.eventView)&&void 0!==o?o:c;if(void 0===p||void 0===h)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const m={...e,orgSlug:p,eventView:h};return(0,d.tZ)(u,{...m})}function m(e,t,r){return e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...r}})}u.displayName="_GenericDiscoverQuery",h.displayName="GenericDiscoverQuery";const g=h},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,r)=>{r.d(t,{bq:()=>s,uL:()=>i}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("./app/utils/performance/contexts/utils.tsx");const[s,o,i]=(0,n.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,r)=>{r.d(t,{n:()=>s}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js");function s(e){const{strict:t=!0,errorMessage:r=`useContext for "${e.name}" must be inside a Provider with a value`,name:s}=e,o=(0,n.createContext)(void 0);return o.displayName=s,[o.Provider,function(){const e=(0,n.useContext)(o);if(!e&&t)throw new Error(r);return e},o]}},"./app/views/performance/traceDetails/styles.tsx":(e,t,r)=>{r.d(t,{$G:()=>T,CB:()=>m.wh,Iq:()=>v,LA:()=>b,RB:()=>y,W3:()=>Z,X2:()=>m.X2,Z9:()=>x,cC:()=>f,pH:()=>g,qD:()=>m.iF,uI:()=>w});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("./app/components/events/eventTags/eventTagsPill.tsx"),o=r("./app/components/events/interfaces/spans/header.tsx"),i=r("./app/components/panels/index.tsx"),a=r("./app/components/pills.tsx"),l=r("./app/components/searchBar.tsx"),c=r("./app/styles/space.tsx"),d=r("./app/utils.tsx"),p=r("./app/utils/queryString.tsx"),u=r("./app/views/performance/transactionSummary/utils.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),m=r("./app/components/events/interfaces/spans/spanDetail.tsx");const g=(0,n.Z)("div",{target:"euzgho58"})({name:"7whenc",styles:"display:flex;width:100%"}),v=(0,n.Z)(l.Z,{target:"euzgho57"})({name:"1ff36h2",styles:"flex-grow:1"}),f=(0,n.Z)(o.il,{target:"euzgho56"})("position:static;top:auto;border-top:none;border-bottom:1px solid ",(e=>e.theme.border),";"),x=(0,n.Z)("div",{target:"euzgho55"})("display:grid;grid-template-columns:1fr;gap:",(0,c.Z)(3),";margin-bottom:",(0,c.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints.medium),"){grid-template-columns:max-content max-content;grid-row-gap:0;}"),Z=(0,n.Z)("div",{target:"euzgho54"})("margin-top:",(0,c.Z)(2),";"),w=(0,n.Z)("div",{target:"euzgho53"})({name:"1wr20zt",styles:"overflow-x:hidden;border-bottom-left-radius:3px;border-bottom-right-radius:3px"}),b=(0,n.Z)(i.s_,{target:"euzgho52"})({name:"d3v9zr",styles:"overflow:hidden"}),y=(0,n.Z)("span",{target:"euzgho51"})("margin-right:",(0,c.Z)(.75),";display:flex;flex-direction:column;justify-content:center;"),D=(0,n.Z)(a.Z,{target:"euzgho50"})("padding-top:",(0,c.Z)(1.5),";");function T(e){let{location:t,organization:r,transaction:n}=e;const{tags:o}=n;if(!o||o.length<=0)return null;const i=r.slug;return(0,h.BX)("tr",{children:[(0,h.tZ)("td",{className:"key",children:"Tags"}),(0,h.tZ)("td",{className:"value",children:(0,h.tZ)(D,{children:o.map(((e,o)=>{const{pathname:a,query:l}=(0,u.e1)({orgSlug:i,transaction:n.transaction,projectID:String(n.project_id),query:{...t.query,query:(0,p.os)(t.query.query,e.key,e.value)}});return(0,h.tZ)(s.Z,{tag:e,projectId:n.project_slug,organization:r,query:l,streamPath:a},(0,d.ri)(e.key)?e.key:`tag-pill-${o}`)}))})})]})}T.displayName="Tags"},"./app/views/performance/traceDetails/traceNotFound.tsx":(e,t,r)=>{r.d(t,{Z:()=>v});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("../node_modules/react/index.js"),o=r("./app/components/alert.tsx"),i=r("./app/components/links/link.tsx"),a=r("./app/components/loadingError.tsx"),l=r("./app/components/loadingIndicator.tsx"),c=r("./app/components/performance/waterfall/rowDetails.tsx"),d=r("./app/locale.tsx"),p=r("./app/styles/space.tsx"),u=r("./app/utils/discover/discoverQuery.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(e){var t,r;let{meta:n,traceEventView:p,traceSlug:m,organization:v,location:f}=e;const x=null!==(t=null==n?void 0:n.transactions)&&void 0!==t?t:0,Z=null!==(r=null==n?void 0:n.errors)&&void 0!==r?r:0;if(0===x&&Z>0){const e=p.withColumns([{kind:"field",field:"project"},{kind:"field",field:"title"},{kind:"field",field:"issue.id"},{kind:"field",field:"level"}]);return e.query=`trace:${m} !event.type:transaction `,(0,h.tZ)(u.Z,{eventView:e,orgSlug:v.slug,location:f,referrer:"api.trace-view.errors-view",useEvents:!0,children:e=>{let{isLoading:t,tableData:r,error:n}=e;return t?(0,h.tZ)(l.Z,{}):n?(0,h.tZ)(o.Z,{type:"error",showIcon:!0,children:(0,h.tZ)(g,{children:(0,d._N)("The trace cannot be shown when all events are errors. An error occurred when attempting to fetch these error events: [error]",{error:n.message})})}):(0,h.BX)(o.Z,{type:"error",showIcon:!0,children:[(0,h.tZ)(g,{children:(0,d.t)("The trace cannot be shown when all events are errors.")}),(0,h.tZ)(c.TV,{"data-test-id":"trace-view-errors",children:null==r?void 0:r.data.map((e=>(0,h.BX)(s.Fragment,{children:[(0,h.tZ)(c._U,{level:e.level}),(0,h.tZ)(c.wE,{children:e.level}),(0,h.tZ)(c.St,{children:(0,h.tZ)(i.Z,{to:`/organizations/${v.slug}/issues/${e["issue.id"]}/events/${e.id}`,children:e.title})})]},e.id)))})]})}})}return(0,h.tZ)(a.Z,{message:(0,d.t)("The trace you are looking for was not found.")})}m.displayName="TraceNotFound";const g=(0,n.Z)("div",{target:"etqb06g0"})("margin-bottom:",(0,p.Z)(1),";"),v=m},"./app/views/performance/traceDetails/traceView.tsx":(e,t,r)=>{r.d(t,{Z:()=>ce}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/react/index.js"),s=r("../node_modules/@sentry/hub/esm/hub.js"),o=r("./app/components/events/interfaces/spans/anchorLinkManager.tsx"),i=r("./app/components/events/interfaces/spans/dividerHandlerManager.tsx"),a=r("./app/components/events/interfaces/spans/scrollbarManager.tsx"),l=r("./app/components/performance/waterfall/messageRow.tsx"),c=r("./app/components/performance/waterfall/miniHeader.tsx"),d=r("./app/components/performance/waterfall/utils.tsx"),p=r("./app/locale.tsx"),u=r("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),h=r("./app/views/performance/traceDetails/styles.tsx"),m=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),g=r("./app/components/assistant/guideAnchor.tsx"),v=r("./app/components/count.tsx"),f=r("./app/components/idBadge/projectBadge.tsx"),x=r("./app/components/performance/waterfall/constants.tsx"),Z=r("./app/components/performance/waterfall/row.tsx"),w=r("./app/components/performance/waterfall/rowBar.tsx"),b=r("./app/components/performance/waterfall/rowDivider.tsx"),y=r("./app/components/performance/waterfall/rowTitle.tsx"),D=r("./app/components/performance/waterfall/treeConnector.tsx"),T=r("./app/components/tooltip.tsx"),_=r("./app/utils/performance/quickTrace/utils.tsx"),C=r("./app/utils/projects.tsx"),j=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),E=r("../node_modules/react-router/es/index.js"),S=r("../node_modules/lodash/omit.js"),B=r.n(S),I=r("./app/components/alert.tsx"),V=r("./app/components/button.tsx"),k=r("./app/components/dateTime.tsx"),O=r("./app/components/links/link.tsx"),z=r("./app/components/performance/waterfall/rowDetails.tsx"),A=r("./app/components/quickTrace/utils.tsx"),X=r("./app/constants/pageFilters.tsx"),L=r("./app/icons/index.tsx"),P=r("./app/styles/space.tsx"),$=r("./app/utils/discover/urls.tsx"),H=r("./app/utils/getDynamicText.tsx"),M=r("./app/utils/performance/urls.ts"),R=r("./app/utils/performance/vitals/constants.tsx"),N=r("./app/utils/performanceForSentry.tsx"),q=r("./app/views/performance/transactionSummary/utils.tsx"),F=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class G extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"scrollBarIntoView",(e=>t=>{t.preventDefault();const r=`#txn-${e}`;this.props.scrollToHash(r),E.browserHistory.push({...this.props.location,hash:r})}))}renderTransactionErrors(){const{organization:e,transaction:t}=this.props,{errors:r}=t;return 0===r.length?null:(0,F.tZ)(I.Z,{system:!0,showIcon:!0,type:"error",expand:r.map((t=>(0,F.BX)(z.TV,{children:[(0,F.tZ)(z._U,{level:t.level}),(0,F.tZ)(z.wE,{children:t.level}),(0,F.tZ)(z.St,{children:(0,F.tZ)(O.Z,{to:(0,A.F7)(t,e),children:t.title})})]},t.event_id))),children:(0,F.tZ)(z.CM,{children:(0,p.tn)("An error event occurred in this transaction.","%s error events occurred in this transaction.",r.length)})})}renderGoToTransactionButton(){const{location:e,organization:t,transaction:r}=this.props,n=(0,$.JE)({id:r.event_id,project:r.project_slug}),s=(0,M.D)(t.slug,n,r.transaction,B()(e.query,Object.values(X.V)));return(0,F.tZ)(W,{size:"xsmall",to:s,children:(0,p.t)("View Event")})}renderGoToSummaryButton(){const{location:e,organization:t,transaction:r}=this.props,n=(0,q.e1)({orgSlug:t.slug,transaction:r.transaction,query:B()(e.query,Object.values(X.V)),projectID:String(r.project_id)});return(0,F.tZ)(W,{size:"xsmall",to:n,children:(0,p.t)("View Summary")})}renderMeasurements(){const{transaction:e}=this.props,{measurements:t={}}=e,r=Object.keys(t).filter((e=>Boolean(R.r9[`measurements.${e}`]))).sort();return r.length<=0?null:(0,F.tZ)(n.Fragment,{children:r.map((e=>{var r;return(0,F.tZ)(h.X2,{title:null===(r=R.r9[`measurements.${e}`])||void 0===r?void 0:r.name,children:`${Number(t[e].value.toFixed(3)).toLocaleString()}ms`},e)}))})}renderTransactionDetail(){const{location:e,organization:t,transaction:r}=this.props,s=Math.min(r.start_timestamp,r.timestamp),o=Math.max(r.start_timestamp,r.timestamp),i=`${Number((1e3*(o-s)).toFixed(3)).toLocaleString()}ms`;return(0,F.tZ)(h.qD,{children:(0,F.tZ)("table",{className:"table key-value",children:(0,F.BX)("tbody",{children:[(0,F.tZ)(h.X2,{title:(0,F.BX)(Q,{onClick:this.scrollBarIntoView(r.event_id),children:[(0,p.t)("Event ID"),(0,F.tZ)(U,{})]}),extra:this.renderGoToTransactionButton(),children:r.event_id}),(0,F.tZ)(h.X2,{title:"Transaction",extra:this.renderGoToSummaryButton(),children:r.transaction}),(0,F.tZ)(h.X2,{title:"Transaction Status",children:r["transaction.status"]}),(0,F.tZ)(h.X2,{title:"Span ID",children:r.span_id}),(0,F.tZ)(h.X2,{title:"Project",children:r.project_slug}),(0,F.tZ)(h.X2,{title:"Start Date",children:(0,H.Z)({fixed:"Mar 19, 2021 11:06:27 AM UTC",value:(0,F.BX)(n.Fragment,{children:[(0,F.tZ)(k.Z,{date:1e3*s}),` (${s})`]})})}),(0,F.tZ)(h.X2,{title:"End Date",children:(0,H.Z)({fixed:"Mar 19, 2021 11:06:28 AM UTC",value:(0,F.BX)(n.Fragment,{children:[(0,F.tZ)(k.Z,{date:1e3*o}),` (${o})`]})})}),(0,F.tZ)(h.X2,{title:"Duration",children:i}),(0,F.tZ)(h.X2,{title:"Operation",children:r["transaction.op"]||""}),this.renderMeasurements(),(0,F.tZ)(h.$G,{location:e,organization:t,transaction:r})]})})})}render(){return(0,F.tZ)(N.BZ,{id:"TransactionDetail",children:(0,F.BX)(h.CB,{onClick:e=>{e.stopPropagation()},children:[this.renderTransactionErrors(),this.renderTransactionDetail()]})})}}G.displayName="TransactionDetail";const Q=(0,j.Z)("a",{target:"eykqe522"})("display:flex;color:",(e=>e.theme.textColor),";:hover{color:",(e=>e.theme.textColor),";}"),U=(0,j.Z)(L.rS,{target:"eykqe521"})("display:block;color:",(e=>e.theme.gray300),";margin-left:",(0,P.Z)(1),";"),W=(0,j.Z)(V.ZP,{target:"eykqe520"})("position:absolute;top:",(0,P.Z)(.75),";right:",(0,P.Z)(.5),";"),J=G;class Y extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"state",{showDetail:!1}),(0,m.Z)(this,"transactionRowDOMRef",(0,n.createRef)()),(0,m.Z)(this,"toggleDisplayDetail",(()=>{const{transaction:e}=this.props;(0,_.Ci)(e)&&this.setState((e=>({showDetail:!e.showDetail})))})),(0,m.Z)(this,"scrollIntoView",(()=>{const e=this.transactionRowDOMRef.current;if(!e)return;const t=e.getBoundingClientRect().top+window.scrollY;this.setState({showDetail:!0},(()=>window.scrollTo(0,t)))}))}getCurrentOffset(){const{transaction:e}=this.props,{generation:t}=e;return K(t)}renderConnector(e){const{continuingDepths:t,isExpanded:r,isOrphan:n,isLast:s,transaction:o}=this.props,{generation:i}=o,a=(0,_.Ci)(o)?o.event_id:o.traceSlug;if(0===i)return e?(0,F.tZ)(D.UV,{style:{right:"15px",height:"10px",bottom:"-5px",top:"auto"},orphanBranch:!1}):null;const l=t.map((e=>{let{depth:t,isOrphanDepth:r}=e;if(i-t<=1)return null;const n=-1*K(i-t-1)-2;return(0,F.tZ)(D.UV,{style:{left:n},orphanBranch:r},`${a}-${t}`)}));return e&&r&&l.push((0,F.tZ)(D.UV,{style:{right:"15px",height:"10px",bottom:s?`-${x.d/2+1}px`:"0",top:"auto"},orphanBranch:!1},`${a}-last`)),(0,F.tZ)(D.DN,{isLast:s,hasToggler:e,orphanBranch:n,children:l})}renderToggle(e){const{isExpanded:t,transaction:r,toggleExpandedState:n}=this.props,{children:s,generation:o}=r,i=this.getCurrentOffset();if(s.length<=0)return(0,F.tZ)(D.rw,{style:{left:`${i}px`},children:this.renderConnector(!1)});const a=0===o;return(0,F.BX)(D.rw,{style:{left:`${i}px`},hasToggler:!0,children:[this.renderConnector(!0),(0,F.BX)(D.U1,{disabled:a,isExpanded:t,errored:e,onClick:e=>{e.stopPropagation(),a||n()},children:[(0,F.tZ)(v.Z,{value:s.length}),!a&&(0,F.tZ)("div",{children:(0,F.tZ)(D.jd,{direction:t?"up":"down"})})]})]})}renderTitle(e){const{generateContentSpanBarRef:t}=e,{organization:r,transaction:s}=this.props,o=this.getCurrentOffset(),i=!!(0,_.Ci)(s)&&s.errors.length>0,a=(0,_.Ci)(s)?(0,F.BX)(n.Fragment,{children:[(0,F.tZ)(C.Z,{orgId:r.slug,slugs:[s.project_slug],children:e=>{let{projects:t}=e;const r=t.find((e=>e.slug===s.project_slug));return(0,F.tZ)(h.RB,{children:(0,F.tZ)(T.Z,{title:s.project_slug,children:(0,F.tZ)(f.Z,{project:r||{slug:s.project_slug},avatarSize:16,hideName:!0})})})}}),(0,F.BX)(y.rv,{errored:i,children:[(0,F.BX)("strong",{children:[s["transaction.op"]," — "]}),s.transaction]})]}):(0,F.BX)(y.rv,{errored:!1,children:[(0,F.tZ)("strong",{children:"Trace — "}),s.traceSlug]});return(0,F.BX)(y.mw,{ref:t(),children:[this.renderToggle(i),(0,F.tZ)(y.Wh,{style:{left:`${o}px`,width:"100%"},children:a})]})}renderDivider(e){if(this.state.showDetail)return(0,F.tZ)(b.xN,{showDetail:!0,style:{position:"absolute"}});const{addDividerLineRef:t}=e;return(0,F.tZ)(b.xN,{ref:t(),style:{position:"absolute"},onMouseEnter:()=>{e.setHover(!0)},onMouseLeave:()=>{e.setHover(!1)},onMouseOver:()=>{e.setHover(!0)},onMouseDown:e.onDragStart,onClick:e=>{e.stopPropagation()}})}renderGhostDivider(e){const{dividerPosition:t,addGhostDividerLineRef:r}=e;return(0,F.tZ)(b.Hr,{style:{width:`calc(${(0,d.yI)(t)} + 0.5px)`,display:"none"},children:(0,F.tZ)(b.xN,{ref:r(),style:{right:0},className:"hovering",onClick:e=>{e.stopPropagation()}})})}renderErrorBadge(){const{transaction:e}=this.props;return(0,_.Ci)(e)&&e.errors.length?(0,F.tZ)(b.cS,{}):null}renderRectangle(){const{transaction:e,traceInfo:t,barColor:r}=this.props,{showDetail:n}=this.state,s=Math.abs(t.endTimestamp-t.startTimestamp)||1,o=Math.abs(e.start_timestamp-t.startTimestamp)/s,i=Math.abs(e.timestamp-e.start_timestamp),a=i/s;return(0,F.tZ)(w.e,{spanBarHatch:!1,style:{backgroundColor:r,left:`min(${(0,d.yI)(o||0)}, calc(100% - 1px))`,width:(0,d.yI)(a||0)},children:(0,F.tZ)(w.R,{durationDisplay:(0,d.ud)({left:o,width:a}),showDetail:n,spanBarHatch:!1,children:(0,d.bQ)(i)})})}renderHeader(e){let{dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:r}=e;const{hasGuideAnchor:n,index:s}=this.props,{showDetail:o}=this.state,{dividerPosition:i}=t;return(0,F.BX)(Z.Qc,{showDetail:o,children:[(0,F.tZ)(Z.E5,{"data-test-id":"transaction-row-title","data-type":"span-row-cell",style:{width:`calc(${(0,d.yI)(i)} - 0.5px)`,paddingTop:0},showDetail:o,onClick:this.toggleDisplayDetail,children:(0,F.tZ)(g.Z,{target:"trace_view_guide_row",disabled:!n,children:this.renderTitle(r)})}),(0,F.BX)(b.kP,{children:[this.renderDivider(t),this.renderErrorBadge()]}),(0,F.tZ)(Z.E5,{"data-test-id":"transaction-row-duration","data-type":"span-row-cell",showStriping:s%2!=0,style:{width:`calc(${(0,d.yI)(1-i)} - 0.5px)`,paddingTop:0},showDetail:o,onClick:this.toggleDisplayDetail,children:(0,F.tZ)(g.Z,{target:"trace_view_guide_row_details",disabled:!n,children:this.renderRectangle()})}),!o&&this.renderGhostDivider(t)]})}renderDetail(){const{location:e,organization:t,isVisible:r,transaction:n}=this.props,{showDetail:s}=this.state;return(0,F.tZ)(o.$,{children:o=>{let{registerScrollFn:i,scrollToHash:a}=o;return(0,_.Ci)(n)?(i(`#txn-${n.event_id}`,this.scrollIntoView,!1),r&&s?(0,F.tZ)(J,{location:e,organization:t,transaction:n,scrollToHash:a}):null):null}})}render(){const{isVisible:e,transaction:t}=this.props,{showDetail:r}=this.state;return(0,F.BX)(Z.X2,{ref:this.transactionRowDOMRef,visible:e,showBorder:r,cursor:(0,_.Ci)(t)?"pointer":"default",children:[(0,F.tZ)(a.$6,{children:e=>(0,F.tZ)(i.$,{children:t=>this.renderHeader({dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:e})})}),this.renderDetail()]})}}function K(e){return e*(D.Ll/2)+0}Y.displayName="TransactionBar";const ee=Y;class te extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"state",{isExpanded:!0}),(0,m.Z)(this,"toggleExpandedState",(()=>{this.setState((e=>{let{isExpanded:t}=e;return{isExpanded:!t}}))}))}componentDidUpdate(e,t){t.isExpanded!==this.state.isExpanded&&this.props.updateScrollState()}render(){const{location:e,organization:t,transaction:r,traceInfo:s,continuingDepths:o,isOrphan:i,isLast:a,index:l,isVisible:c,hasGuideAnchor:d,renderedChildren:p,barColor:u}=this.props,{isExpanded:h}=this.state;return(0,F.BX)(n.Fragment,{children:[(0,F.tZ)(ee,{location:e,organization:t,index:l,transaction:r,traceInfo:s,continuingDepths:o,isOrphan:i,isLast:a,isExpanded:h,toggleExpandedState:this.toggleExpandedState,isVisible:c,hasGuideAnchor:d,barColor:u}),h&&p]})}}te.displayName="TransactionGroup";const re=(0,a.Iw)(te);var ne=r("./app/views/performance/traceDetails/utils.tsx"),se=r("./app/components/discover/discoverFeature.tsx");function oe(e){var t;let{traceInfo:r,traceEventView:n,organization:s,meta:o}=e;const i=r.transactions.size,a=null!==(t=null==o?void 0:o.transactions)&&void 0!==t?t:i;if(null===a||i>=a)return null;const c=n.getResultsViewUrlTarget(s.slug);return(0,F.tZ)(l.V,{children:(0,p._N)("Limited to a view of [count] transactions. To view the full list, [discover].",{count:i,discover:(0,F.tZ)(se.Z,{children:e=>{let{hasFeature:t}=e;return(0,F.tZ)(O.Z,{disabled:!t,to:c,children:(0,p.t)("Open in Discover")})}})})})}oe.displayName="LimitExceededMessage";const ie=oe;var ae=r("./app/views/performance/traceDetails/traceNotFound.tsx");function le(e){let{isVisible:t,numberOfHiddenTransactionsAbove:r}=e;return!t||r<1?null:(0,F.tZ)(l.V,{children:(0,F.tZ)("span",{children:1===r?(0,p._N)("[numOfTransaction] hidden transaction",{numOfTransaction:(0,F.tZ)("strong",{children:r})}):(0,p._N)("[numOfTransaction] hidden transactions",{numOfTransaction:(0,F.tZ)("strong",{children:r})})},"trace-info-message")})}function ce(e){var t;let{location:r,meta:l,organization:p,traces:m,traceSlug:g,traceEventView:v,filteredTransactionIds:f,...x}=e;const Z=null===(t=s.Gd().getScope())||void 0===t?void 0:t.getTransaction(),w=null==Z?void 0:Z.startChild({op:"trace.render",description:"trace-view-content"});function b(e,t){let{continuingDepths:s,isOrphan:o,isLast:i,index:a,numberOfHiddenTransactionsAbove:l,traceInfo:c,hasGuideAnchor:u}=t;const{children:h,event_id:m}=e,g=e.generation+1,v=function(e,t){return!t||t.has(e.event_id)}(e,f),x=h.reduce(((e,t,r)=>{const n=r===h.length-1,i=t.children.length>0,a=b(t,{continuingDepths:!n&&i?[...s,{depth:g,isOrphanDepth:o}]:s,isOrphan:o,isLast:n,index:e.lastIndex+1,numberOfHiddenTransactionsAbove:e.numberOfHiddenTransactionsAbove,traceInfo:c,hasGuideAnchor:!1});return e.lastIndex=a.lastIndex,e.numberOfHiddenTransactionsAbove=a.numberOfHiddenTransactionsAbove,e.renderedChildren.push(a.transactionGroup),e}),{renderedChildren:[],lastIndex:a,numberOfHiddenTransactionsAbove:v?0:l+1});return{transactionGroup:(0,F.BX)(n.Fragment,{children:[(0,F.tZ)(le,{isVisible:v,numberOfHiddenTransactionsAbove:l}),(0,F.tZ)(re,{location:r,organization:p,traceInfo:c,transaction:{...e,generation:g},continuingDepths:s,isOrphan:o,isLast:i,index:a,isVisible:v,hasGuideAnchor:u,renderedChildren:x.renderedChildren,barColor:(0,d.hd)(e["transaction.op"])})]},m),lastIndex:x.lastIndex,numberOfHiddenTransactionsAbove:x.numberOfHiddenTransactionsAbove}}(0,n.useEffect)((()=>{(0,u.Z)("performance_views.trace_view.view",{organization:p})}),[p]);const y=(0,n.createRef)(),D=(0,n.createRef)();if(null===m||m.length<=0)return(0,F.tZ)(ae.Z,{meta:l,traceEventView:v,traceSlug:g,location:r,organization:p});const T=x.traceInfo||(0,ne.Rg)(m),_={index:1,numberOfHiddenTransactionsAbove:0,traceInfo:T,transactionGroups:[]},{transactionGroups:C,numberOfHiddenTransactionsAbove:j}=m.reduce(((e,t,r)=>{const n=r===m.length-1,s=t.children.length>0,o=!n&&null!==m[r+1].parent_span_id,i=b(t,{...e,isOrphan:!(0,ne.uM)(t),isLast:n,continuingDepths:!n&&s?[{depth:0,isOrphanDepth:o}]:[],hasGuideAnchor:0===r});return e.index=i.lastIndex+1,e.numberOfHiddenTransactionsAbove=i.numberOfHiddenTransactionsAbove,e.transactionGroups.push(i.transactionGroup),e}),_),E=(0,F.tZ)(h.W3,{children:(0,F.tZ)(i.z,{interactiveLayerRef:y,children:(0,F.tZ)(i.$,{children:e=>{let{dividerPosition:t}=e;return(0,F.tZ)(a.zt,{dividerPosition:t,interactiveLayerRef:D,children:(0,F.BX)(h.LA,{children:[(0,F.BX)(h.cC,{children:[(0,F.tZ)(a.$6,{children:e=>{let{virtualScrollbarRef:r,scrollBarAreaRef:n,onDragStart:s,onScroll:o}=e;return(0,F.BX)(c.cs,{ref:D,style:{width:`calc(${(0,d.yI)(t)} - 0.5px)`},onScroll:o,children:[(0,F.tZ)("div",{style:{width:0,height:"1px"},ref:n}),(0,F.tZ)(c.Qk,{"data-type":"virtual-scrollbar",ref:r,onMouseDown:s,children:(0,F.tZ)(c.v6,{})})]})}}),(0,F.tZ)(c._i,{})]}),(0,F.BX)(h.uI,{ref:y,children:[(0,F.tZ)(o.z,{children:(0,F.tZ)(re,{location:r,organization:p,traceInfo:T,transaction:{traceSlug:g,generation:0,"transaction.duration":T.endTimestamp-T.startTimestamp,children:m,start_timestamp:T.startTimestamp,timestamp:T.endTimestamp},continuingDepths:[],isOrphan:!1,isLast:!1,index:0,isVisible:!0,hasGuideAnchor:!1,renderedChildren:C,barColor:(0,d.hd)("")})}),(0,F.tZ)(le,{isVisible:!0,numberOfHiddenTransactionsAbove:j}),(0,F.tZ)(ie,{traceInfo:T,organization:p,traceEventView:v,meta:l})]})]})})}})})});return null==w||w.finish(),E}le.displayName="TraceHiddenMessage"}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_traceDetails_traceView_tsx.42c369570cbb73d00848fea9f258e439.js.map