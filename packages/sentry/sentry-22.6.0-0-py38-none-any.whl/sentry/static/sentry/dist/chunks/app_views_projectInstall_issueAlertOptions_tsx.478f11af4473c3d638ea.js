"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_projectInstall_issueAlertOptions_tsx"],{"./app/views/projectInstall/issueAlertOptions.tsx":(t,e,n)=>{n.d(e,{Z:()=>C,r:()=>A});var s,i,a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/react/index.js")),r=n("../node_modules/@sentry/hub/esm/exports.js"),l=n("../node_modules/lodash/isEqual.js"),d=n.n(l),c=n("./app/components/asyncComponent.tsx"),u=n("./app/components/forms/controls/input.tsx"),p=n("./app/components/forms/controls/radioGroup.tsx"),h=n("./app/components/forms/selectControl.tsx"),v=n("./app/components/pageHeading.tsx"),E=n("./app/locale.tsx"),m=n("./app/styles/space.tsx"),S=n("./app/utils/withOrganization.tsx"),g=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");!function(t){t[t.ERRORS=0]="ERRORS",t[t.USERS=1]="USERS"}(s||(s={})),function(t){t[t.ALERT_ON_EVERY_ISSUE=0]="ALERT_ON_EVERY_ISSUE",t[t.CUSTOMIZED_ALERTS=1]="CUSTOMIZED_ALERTS",t[t.CREATE_ALERT_LATER=2]="CREATE_ALERT_LATER"}(i||(i={}));const R="sentry.rules.conditions.event_frequency.EventUniqueUserFrequencyCondition",f="sentry.rules.conditions.event_frequency.EventFrequencyCondition",A="sentry.rules.conditions.event_frequency.EventFrequencyPercentCondition",_={[s.ERRORS]:f,[s.USERS]:R};function T(t,e,n){let i;switch(e){case s.ERRORS:i=f;break;case s.USERS:i=R;break;default:throw new RangeError("Supplied metric value is not handled")}return{interval:t,id:i,value:n}}class y extends c.Z{getDefaultState(){return{...super.getDefaultState(),conditions:[],intervalChoices:[],alertSetting:i.CREATE_ALERT_LATER.toString(),metric:s.ERRORS,interval:"",threshold:""}}getAvailableMetricOptions(){return[{value:s.ERRORS,label:(0,E.t)("occurrences of")},{value:s.USERS,label:(0,E.t)("users affected by")}].filter((t=>{var e,n;let{value:s}=t;return null===(e=this.state.conditions)||void 0===e||null===(n=e.some)||void 0===n?void 0:n.call(e,(t=>(null==t?void 0:t.id)===_[s]))}))}getIssueAlertsChoices(t){const e=[[i.CREATE_ALERT_LATER.toString(),(0,E.t)("I'll create my own alerts later")],[i.ALERT_ON_EVERY_ISSUE.toString(),(0,E.t)("Alert me on every new issue")]];var n;return t&&e.push([i.CUSTOMIZED_ALERTS.toString(),(0,g.BX)(b,{onClick:t=>{t.preventDefault();const e=i.CUSTOMIZED_ALERTS.toString();this.setStateAndUpdateParents({alertSetting:e})},children:[(0,E.t)("When there are more than"),(0,g.tZ)(x,{type:"number",min:"0",name:"",placeholder:"10",value:this.state.threshold,onChange:t=>this.setStateAndUpdateParents({threshold:t.target.value}),"data-test-id":"range-input"}),(0,g.tZ)(U,{value:this.state.metric,options:this.getAvailableMetricOptions(),onChange:t=>this.setStateAndUpdateParents({metric:t.value}),"data-test-id":"metric-select-control"}),(0,E.t)("a unique error in"),(0,g.tZ)(U,{value:this.state.interval,options:null===(n=this.state.intervalChoices)||void 0===n?void 0:n.map((t=>{let[e,n]=t;return{value:e,label:n}})),onChange:t=>this.setStateAndUpdateParents({interval:t.value}),"data-test-id":"interval-select-control"})]},i.CUSTOMIZED_ALERTS)]),e.map((t=>{let[e,n]=t;return[e,(0,g.tZ)(O,{children:n},e)]}))}getUpdatedData(){let t,e;switch(parseInt(this.state.alertSetting,10)){case i.ALERT_ON_EVERY_ISSUE:t=!0,e=!1;break;case i.CREATE_ALERT_LATER:t=!1,e=!1;break;case i.CUSTOMIZED_ALERTS:t=!1,e=!0;break;default:throw new RangeError("Supplied alert creation action is not handled")}return{defaultRules:t,shouldCreateCustomRule:e,name:"Send a notification for new issues",conditions:this.state.interval.length>0&&this.state.threshold.length>0?[T(this.state.interval,this.state.metric,this.state.threshold)]:void 0,actions:[{id:"sentry.rules.actions.notify_event.NotifyEventAction"}],actionMatch:"all",frequency:5}}setStateAndUpdateParents(t,e){this.setState(t,(()=>{null==e||e(),this.props.onChange(this.getUpdatedData())}))}getEndpoints(){return[["conditions",`/projects/${this.props.organization.slug}/rule-conditions/`]]}onLoadAllEndpointsSuccess(){var t,e;const n=null===(t=this.state.conditions)||void 0===t||null===(e=t.filter)||void 0===e?void 0:e.call(t,(t=>Object.values(_).includes(null==t?void 0:t.id)));if(!n||0===n.length)return void this.setStateAndUpdateParents({conditions:void 0});const{intervalChoices:s,interval:i}=function(t){var e;const n=t.map((t=>{var e,n;return null===(e=t.formFields)||void 0===e||null===(n=e.interval)||void 0===n?void 0:n.choices})).reduce(((t,e)=>t&&e&&d()(t,e)?t:null));return{intervalChoices:n,interval:null==n||null===(e=n[0])||void 0===e?void 0:e[0]}}(n);if(!s||!i)return r.$e((t=>{t.setExtra("props",this.props),t.setExtra("state",this.state),r.Tb(new Error("Interval choices or sent from API endpoint is inconsistent or empty"))})),void this.setStateAndUpdateParents({conditions:void 0});this.setStateAndUpdateParents({conditions:n,intervalChoices:s,interval:i})}renderBody(){var t;const e=this.getIssueAlertsChoices((null===(t=this.state.conditions)||void 0===t?void 0:t.length)>0);return(0,g.BX)(o.Fragment,{children:[(0,g.tZ)(w,{withMargins:!0,children:(0,E.t)("Set your default alert settings")}),(0,g.tZ)(Z,{choices:e,label:(0,E.t)("Options for creating an alert"),onChange:t=>this.setStateAndUpdateParents({alertSetting:t}),value:this.state.alertSetting})]})}}const C=(0,S.Z)(y),b=(0,a.Z)("div",{target:"e12p23qf5"})("display:grid;grid-template-columns:repeat(5, max-content);gap:",(0,m.Z)(1),";align-items:center;"),x=(0,a.Z)(u.Z,{target:"e12p23qf4"})({name:"m0jwvv",styles:"width:80px"}),U=(0,a.Z)(h.Z,{target:"e12p23qf3"})({name:"efbx4f",styles:"width:160px"}),Z=(0,a.Z)(p.Z,{target:"e12p23qf2"})("padding:",(0,m.Z)(3)," 0;margin-bottom:50px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.1);"),w=(0,a.Z)(v.Z,{target:"e12p23qf1"})({name:"1ojfw6c",styles:"margin-top:65px"}),O=(0,a.Z)("div",{target:"e12p23qf0"})({name:"p9mutn",styles:"min-height:35px;display:flex;flex-direction:column;justify-content:center"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_projectInstall_issueAlertOptions_tsx.58f9e4482af20392caa6488247ce470e.js.map