"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_list_rules_index_tsx"],{"./app/components/alertBadge.tsx":(e,t,s)=>{s.d(t,{Z:()=>c});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("./app/icons/index.tsx"),i=s("./app/locale.tsx"),n=s("./app/styles/space.tsx"),l=s("./app/views/alerts/types.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{status:t,hideText:s=!1,isIssue:a}=e,n=(0,i.t)("Resolved"),d=r.DL,c="green300";return a?(n=(0,i.t)("Issue"),d=r.XI,c="gray300"):t===l.vt.CRITICAL?(n=(0,i.t)("Critical"),d=r.zC,c="red300"):t===l.vt.WARNING&&(n=(0,i.t)("Warning"),d=r.qV,c="yellow300"),(0,o.BX)(p,{"data-test-id":"alert-badge",children:[(0,o.BX)(u,{color:c,icon:d,children:[(0,o.tZ)(h,{color:c}),(0,o.tZ)(d,{color:"white"})]}),!s&&(0,o.tZ)(m,{color:c,children:n})]})}d.displayName="AlertBadge";const c=d,p=(0,a.Z)("div",{target:"ef4c9wd3"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),u=(0,a.Z)("div",{target:"ef4c9wd2"})("width:36px;height:36px;position:relative;svg:last-child{width:",(e=>e.icon===r.XI?"13px":"16px"),";z-index:2;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;}"),h=(0,a.Z)(r.Sq,{target:"ef4c9wd1"})({name:"bgbjt4",styles:"width:36px;height:36px"}),m=(0,a.Z)("div",{target:"ef4c9wd0"})("margin-left:",(0,n.Z)(1),";")},"./app/views/alerts/list/rules/index.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>me});var a=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/react/index.js")),n=s("./app/actionCreators/indicator.tsx"),l=s("./app/components/asyncComponent.tsx"),o=s("./app/components/layouts/thirds.tsx"),d=s("./app/components/links/link.tsx"),c=s("./app/components/organizations/pageFilters/container.tsx"),p=s("./app/components/pagination.tsx"),u=s("./app/components/panels/index.tsx"),h=s("./app/components/sentryDocumentTitle.tsx"),m=s("./app/icons/index.tsx"),g=s("./app/locale.tsx"),x=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),Z=s("./app/utils/projects.tsx"),v=s("./app/utils/teams.tsx"),w=s("./app/utils/withPageFilters.tsx"),y=s("./app/views/alerts/filterBar.tsx"),f=s("./app/views/alerts/types.tsx"),I=s("./app/views/alerts/utils/index.tsx"),b=s("./app/views/alerts/list/header.tsx"),C=s("../node_modules/lodash/memoize.js"),A=s.n(C),k=s("./app/components/acl/access.tsx"),j=s("./app/components/alertBadge.tsx"),T=s("./app/components/avatar/actorAvatar.tsx"),z=s("./app/components/avatar/teamAvatar.tsx"),B=s("./app/components/confirm.tsx"),L=s("./app/components/dropdownAutoComplete/index.tsx"),R=s("./app/components/dropdownBubble.tsx"),$=s("./app/components/dropdownMenuControlV2.tsx"),_=s("./app/components/errorBoundary.tsx"),q=s("./app/components/highlight.tsx"),E=s("./app/components/idBadge/index.tsx"),S=s("./app/components/loadingIndicator.tsx"),D=s("./app/components/textOverflow.tsx"),N=s("./app/components/timeSince.tsx"),X=s("./app/components/tooltip.tsx"),G=s("./app/styles/space.tsx"),O=s("./app/views/alerts/rules/metric/constants.tsx"),F=s("./app/views/alerts/rules/metric/types.tsx"),P=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const V=A()(((e,t)=>t.find((t=>t.slug===e))));function U(e){var t,s,a,r,n;let{rule:l,projectsLoaded:o,projects:c,orgId:p,onDelete:u,onOwnerChange:h,userTeams:x,hasDuplicateAlertRules:Z,hasEditAccess:v}=e;const[w,y]=(0,i.useState)(""),b=void 0!==(null===(t=l.latestIncident)||void 0===t?void 0:t.status)&&[f.vt.CRITICAL,f.vt.WARNING].includes(l.latestIncident.status),C=l.projects[0],A=`/organizations/${p}/alerts/${(0,I.Gm)(l)?"rules":"metric-rules"}/${C}/${l.id}/`,R={pathname:`/organizations/${p}/alerts/new/${l.type===f.XO.METRIC?"metric":"issue"}/`,query:{project:C,duplicateRuleId:l.id,createFromDuplicate:!0,referrer:"alert_stream"}},E=`/organizations/${p}/alerts/rules/details/${l.id}/`,D=null===(s=l.owner)||void 0===s?void 0:s.split(":")[1],G=D?{type:"team",id:D,name:""}:null,U=!D||x.has(D),pe=(0,I.Gm)(l)?(0,P.tZ)(d.Z,{to:`/organizations/${p}/alerts/rules/${l.projects[0]}/${l.id}/details/`,children:l.name}):(0,P.tZ)(W,{to:(0,I.Gm)(l)?A:E,children:l.name}),ue={[f.vt.CRITICAL]:(0,g.t)("Critical"),[f.vt.WARNING]:(0,g.t)("Warning"),[f.vt.CLOSED]:(0,g.t)("Resolved"),[f.vt.OPENED]:(0,g.t)("Resolved")},he=[{key:"edit",label:(0,g.t)("Edit"),to:A},{key:"duplicate",label:(0,g.t)("Duplicate"),to:R,hidden:!Z},{key:"delete",label:(0,g.t)("Delete"),priority:"danger",onAction:()=>{(0,B._)({onConfirm:()=>u(C,l),header:(0,g.t)("Delete Alert Rule?"),message:(0,g._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:l.name}),confirmText:(0,g.t)("Delete Rule"),priority:"danger"})}}],me={value:"",label:()=>(0,P.BX)(de,{children:[(0,P.tZ)(le,{size:"20px"}),(0,g.t)("Unassigned")]}),searchKey:"unassigned",actor:"",disabled:!1},ge=c.filter((e=>e.slug===C))[0].teams,xe=null==ge?void 0:ge.filter((e=>x.has(e.id))),Ze=null==xe?void 0:xe.map(((e,t)=>({value:e.id,searchKey:e.slug,label:s=>{let{inputValue:a}=s;return(0,P.BX)(de,{"data-test-id":"assignee-option",children:[(0,P.tZ)(oe,{children:(0,P.tZ)(z.Z,{team:e,size:24})}),(0,P.tZ)(ce,{children:(0,P.tZ)(q.Z,{text:a,children:`#${e.slug}`})})]},t)}}))).concat(me),ve=null==w?void 0:w.split(":")[1],we=null==xe?void 0:xe.find((e=>e.id===ve)),ye=w&&{type:"team",id:ve,name:""},fe=ye?(0,P.tZ)(T.Z,{actor:ye,className:"avatar",size:24,tooltip:(0,P.tZ)(ne,{children:(0,g._N)("Assigned to [name]",{name:we&&`#${we.name}`})})}):(0,P.tZ)(X.Z,{isHoverable:!0,skipWrapper:!0,title:(0,g.t)("Unassigned"),children:(0,P.tZ)(le,{size:"20px",color:"gray400"})});return(0,P.BX)(_.Z,{children:[(0,P.BX)(M,{isIssueAlert:(0,I.Gm)(l),children:[(0,P.tZ)(H,{children:(0,P.tZ)(X.Z,{title:(0,I.Gm)(l)?(0,g.t)("Issue Alert"):(0,g._N)("Metric Alert Status: [status]",{status:ue[null!==(a=null==l||null===(r=l.latestIncident)||void 0===r?void 0:r.status)&&void 0!==a?a:f.vt.CLOSED]}),children:(0,P.tZ)(j.Z,{status:null==l||null===(n=l.latestIncident)||void 0===n?void 0:n.status,isIssue:(0,I.Gm)(l),hideText:!0})})}),(0,P.BX)(K,{children:[(0,P.tZ)(Y,{children:pe}),(0,P.tZ)(J,{children:(0,I.Gm)(l)?l.lastTriggered?(0,P.BX)("div",{children:[(0,g.t)("Triggered "),(0,P.tZ)(N.Z,{date:l.lastTriggered})]}):(0,g.t)("Alerts not triggered yet"):l.latestIncident?b?(0,P.BX)("div",{children:[(0,g.t)("Triggered "),(0,P.tZ)(N.Z,{date:l.latestIncident.dateCreated})]}):(0,P.BX)("div",{children:[(0,g.t)("Resolved "),(0,P.tZ)(N.Z,{date:l.latestIncident.dateClosed})]}):(0,g.t)("Alerts not triggered yet")})]})]}),(0,P.tZ)(H,{children:function(){var e,t;if((0,I.Gm)(l))return null;const s=l.triggers.find((e=>{let{label:t}=e;return t===F.F4.CRITICAL})),a=l.triggers.find((e=>{let{label:t}=e;return t===F.F4.WARNING})),r=l.resolveThreshold,i=b&&(null===(e=l.latestIncident)||void 0===e?void 0:e.status)===f.vt.CRITICAL?s:null!=a?a:s;let n,o="green300",d=b&&l.thresholdType===F.lT.ABOVE?(0,g.t)("Above"):(0,g.t)("Below");return b?(o=(null==i?void 0:i.label)===F.F4.CRITICAL?"red300":(null==i?void 0:i.label)===F.F4.WARNING?"yellow300":"green300",n=l.thresholdType===F.lT.ABOVE?"up":"down"):(n=l.thresholdType===F.lT.ABOVE?"down":"up",d=l.thresholdType===F.lT.ABOVE?(0,g.t)("Below"):(0,g.t)("Above")),(0,P.BX)(H,{children:[(0,P.tZ)(m.CC,{color:o,direction:n}),(0,P.BX)(te,{children:[`${d} ${l.latestIncident||!l.latestIncident&&!r?null==i||null===(t=i.alertThreshold)||void 0===t?void 0:t.toLocaleString():null==r?void 0:r.toLocaleString()}`,(0,O.Hq)(l.aggregate,l.comparisonDelta?F.t6.CHANGE:F.t6.COUNT)]})]})}()}),(0,P.tZ)(H,{children:(0,P.tZ)(Q,{children:(0,P.tZ)(ee,{avatarSize:18,project:o?V(C,c):{slug:C}})})}),(0,P.tZ)(H,{children:G?(0,P.tZ)(T.Z,{actor:G,size:24}):(0,P.BX)(ae,{children:[!o&&(0,P.tZ)(S.Z,{mini:!0,style:{height:"24px",margin:0,marginRight:11}}),o&&(0,P.tZ)(L.Z,{"data-test-id":"alert-row-assignee",maxHeight:400,onOpen:e=>{null==e||e.stopPropagation()},items:Ze,alignMenu:"right",onSelect:function(e){let{value:t}=e;const s=t&&`team:${t}`;y(s),h(C,l,s)},itemSize:"small",searchPlaceholder:(0,g.t)("Filter teams"),disableLabelPadding:!0,emptyHidesInput:!0,disabled:!v,children:e=>{let{getActorProps:t,isOpen:s}=e;return(0,P.BX)(re,{...t({}),children:[fe,v&&(0,P.tZ)(ie,{direction:s?"up":"down",size:"xs"})]})}})]})}),(0,P.tZ)(se,{children:(0,P.tZ)(k.Z,{access:["alerts:write"],children:e=>{let{hasAccess:t}=e;return(0,P.tZ)($.Z,{items:he,placement:"bottom right",triggerProps:{"aria-label":(0,g.t)("Show more"),"data-test-id":"alert-row-actions",size:"xsmall",icon:(0,P.tZ)(m.YR,{size:"xs"}),showChevron:!1},disabledKeys:t&&U?[]:["delete"]})}})})]})}U.displayName="RuleListRow";const W=(0,r.Z)(d.Z,{target:"e1k8ax6w17"})((e=>e.theme.overflowEllipsis),";"),H=(0,r.Z)("div",{target:"e1k8ax6w16"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),M=(0,r.Z)(H,{target:"e1k8ax6w15"})("position:relative;",(e=>e.isIssueAlert&&`padding: ${(0,G.Z)(3)} ${(0,G.Z)(2)}; line-height: 2.4;`),";"),K=(0,r.Z)("div",{target:"e1k8ax6w14"})((e=>e.theme.overflowEllipsis)," margin-left:",(0,G.Z)(2),";line-height:1.35;"),Y=(0,r.Z)("div",{target:"e1k8ax6w13"})((e=>e.theme.overflowEllipsis)," font-size:",(e=>e.theme.fontSizeLarge),";@media (max-width: ",(e=>e.theme.breakpoints.xlarge),"){max-width:300px;}@media (max-width: ",(e=>e.theme.breakpoints.large),"){max-width:165px;}@media (max-width: ",(e=>e.theme.breakpoints.medium),"){max-width:100px;}"),J=(0,r.Z)("div",{target:"e1k8ax6w12"})("color:",(e=>e.theme.gray300),";"),Q=(0,r.Z)("div",{target:"e1k8ax6w11"})({name:"1d3w5wq",styles:"width:100%"}),ee=(0,r.Z)(E.Z,{target:"e1k8ax6w10"})({name:"ozd7xs",styles:"flex-shrink:0"}),te=(0,r.Z)("div",{target:"e1k8ax6w9"})("margin-left:",(0,G.Z)(1),";white-space:nowrap;font-variant-numeric:tabular-nums;"),se=(0,r.Z)(H,{target:"e1k8ax6w8"})("justify-content:center;padding:",(0,G.Z)(1),";"),ae=(0,r.Z)("div",{target:"e1k8ax6w7"})("display:flex;justify-content:flex-end;",R.Z,"{right:-14px;}"),re=(0,r.Z)("div",{target:"e1k8ax6w6"})({name:"1nfrdh1",styles:"display:flex;align-items:center;font-size:20px"}),ie=(0,r.Z)(m.g6,{target:"e1k8ax6w5"})("margin-left:",(0,G.Z)(1),";"),ne=(0,r.Z)("div",{target:"e1k8ax6w4"})({name:"1flj9lk",styles:"text-align:left"}),le=(0,r.Z)(m.qO,{target:"e1k8ax6w3"})({name:"2bhlo8",styles:"margin-right:2px"}),oe=(0,r.Z)("div",{target:"e1k8ax6w2"})({name:"ksp8pg",styles:"display:flex;align-items:center;justify-content:center;width:24px;height:24px;flex-shrink:0"}),de=(0,r.Z)("div",{target:"e1k8ax6w1"})({name:"na9qgn",styles:"display:flex;align-items:center;font-size:13px"}),ce=(0,r.Z)(D.Z,{target:"e1k8ax6w0"})({name:"18jsklt",styles:"margin-left:6px"}),pe=U;class ue extends l.Z{constructor(){super(...arguments),(0,a.Z)(this,"handleChangeFilter",(e=>{const{router:t,location:s}=this.props,{cursor:a,page:r,...i}=s.query;t.push({pathname:s.pathname,query:{...i,team:e.length>0?e:""}})})),(0,a.Z)(this,"handleChangeSearch",(e=>{const{router:t,location:s}=this.props,{cursor:a,page:r,...i}=s.query;t.push({pathname:s.pathname,query:{...i,name:e}})})),(0,a.Z)(this,"handleOwnerChange",((e,t,s)=>{const{orgId:a}=this.props.params,r=`/projects/${a}/${e}/${"alert_rule"===t.type?"alert-rules":"rules"}/${t.id}/`,i={...t,owner:s};this.api.request(r,{method:"PUT",data:i,success:()=>{(0,n.Hz)((0,g.t)("Updated alert rule"),"success")},error:()=>{(0,n.Hz)((0,g.t)("Unable to save change"),"error")}})})),(0,a.Z)(this,"handleDeleteRule",(async(e,t)=>{const{orgId:s}=this.props.params,a=(0,I.Gm)(t)?"rules":"alert-rules";try{await this.api.requestPromise(`/projects/${s}/${e}/${a}/${t.id}/`,{method:"DELETE"}),this.reloadData()}catch(e){(0,n.Iw)((0,g.t)("Error deleting rule"))}}))}getEndpoints(){const{params:e,location:t}=this.props,{query:s}=t;return s.expand=["latestIncident","lastTriggered"],s.team=(0,I.LI)(s.team),s.sort||(s.sort=["incident_status","date_triggered"]),[["ruleList",`/organizations/${e&&e.orgId}/combined-rules/`,{query:s}]]}get projectsFromIncidents(){const{ruleList:e=[]}=this.state;return[...new Set(null==e?void 0:e.map((e=>{let{projects:t}=e;return t})).flat())]}renderLoading(){return this.renderBody()}renderList(){const{params:{orgId:e},location:t,organization:s,router:a}=this.props,{loading:r,ruleList:i=[],ruleListPageLinks:n}=this.state,{query:l}=t,d=s.access.includes("alerts:write"),c={asc:"1"===l.asc,field:l.sort||"date_added"},{cursor:u,page:h,...x}=l,w=c.field.includes("incident_status")||c.field.includes("date_triggered"),b=(0,P.tZ)(m.CC,{color:"gray300",size:"xs",direction:c.asc?"up":"down"});return(0,P.tZ)(o.uT,{children:(0,P.BX)(o.or,{fullWidth:!0,children:[(0,P.tZ)(y.Z,{location:t,onChangeFilter:this.handleChangeFilter,onChangeSearch:this.handleChangeSearch}),(0,P.tZ)(v.Z,{provideUserTeams:!0,children:a=>{let{initiallyLoaded:n,teams:l}=a;return(0,P.tZ)(xe,{headers:[(0,P.BX)(ge,{role:"columnheader","aria-sort":"name"!==c.field?"none":c.asc?"ascending":"descending",to:{pathname:t.pathname,query:{...x,asc:"name"===c.field&&c.asc?void 0:"1",sort:"name"}},children:[(0,g.t)("Alert Rule")," ","name"===c.field&&b]},"name"),(0,P.BX)(ge,{role:"columnheader","aria-sort":w?c.asc?"ascending":"descending":"none",to:{pathname:t.pathname,query:{...x,asc:w&&!c.asc?"1":void 0,sort:["incident_status","date_triggered"]}},children:[(0,g.t)("Status")," ",w&&b]},"status"),(0,g.t)("Project"),(0,g.t)("Team"),(0,g.t)("Actions")],isLoading:r||!n,isEmpty:0===(null==i?void 0:i.length),emptyMessage:(0,g.t)("No alert rules found for the current query."),children:(0,P.tZ)(Z.Z,{orgId:e,slugs:this.projectsFromIncidents,children:t=>{let{initiallyLoaded:a,projects:r}=t;return i.map((t=>(0,P.tZ)(pe,{projectsLoaded:a,projects:r,rule:t,orgId:e,onOwnerChange:this.handleOwnerChange,onDelete:this.handleDeleteRule,userTeams:new Set(l.map((e=>e.id))),hasDuplicateAlertRules:s.features.includes("duplicate-alert-rule"),hasEditAccess:d},`${(0,I.Gm)(t)?f.ok.METRIC:f.ok.ISSUE}-${t.id}`)))}})})}}),(0,P.tZ)(p.Z,{pageLinks:n,onCursor:(e,t,s)=>{let r=x.team;r&&0!==r.length||(r=""),a.push({pathname:t,query:{...x,team:r,cursor:e}})}})]})})}renderBody(){const{params:e,organization:t,router:s}=this.props,{orgId:a}=e;return(0,P.tZ)(h.Z,{title:(0,g.t)("Alerts"),orgSlug:a,children:(0,P.BX)(c.Z,{organization:t,showDateSelector:!1,showEnvironmentSelector:!1,hideGlobalHeader:!0,children:[(0,P.tZ)(b.Z,{organization:t,router:s,activeTab:"rules",projectSlugs:this.projectsFromIncidents}),this.renderList()]})})}}class he extends i.Component{componentDidMount(){this.trackView()}componentDidUpdate(e){var t,s;const{location:a}=this.props;(null===(t=e.location.query)||void 0===t?void 0:t.sort)!==(null===(s=a.query)||void 0===s?void 0:s.sort)&&this.trackView()}trackView(){const{organization:e,location:t}=this.props;(0,x.Z)("alert_rules.viewed",{organization:e,sort:Array.isArray(t.query.sort)?t.query.sort.join(","):t.query.sort})}render(){return(0,P.tZ)(ue,{...this.props})}}he.displayName="AlertRulesListContainer";const me=(0,w.Z)(he),ge=(0,r.Z)(d.Z,{target:"e1hnq40r1"})({name:"1sbdiq8",styles:"color:inherit;:hover{color:inherit;}"}),xe=(0,r.Z)(u.KB,{target:"e1hnq40r0"})("position:static;overflow:auto;@media (min-width: ",(e=>e.theme.breakpoints.small),"){overflow:initial;}grid-template-columns:4fr auto 140px 60px auto;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_list_rules_index_tsx.c2a2787fc8655f00e89176c266d9a47f.js.map