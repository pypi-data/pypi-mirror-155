---
# nexus container
- name: Ensure Nexus o/s group exists
  group:
    name: "{{ nexus_os_group }}"
    state: present

- name: Ensure Nexus o/s user exists
  user:
    name: "{{ nexus_os_user }}"
    group: "{{ nexus_os_group }}"
    home: "{{ nexus_os_user_home_dir }}"
    shell: "/bin/bash"
    state: present
- name: Create Nexus data directory
  file:
    path: "{{ nexus_data_dir }}/nexus-data"
    state: "directory"
    owner: "{{ nexus_os_user }}"
    group: "{{ nexus_os_group }}"
    mode: 0750

- name: Start nexus
  community.docker.docker_container:
    name: nexus_by_bootstrap
    image: "{{ nexus_image }}"
    state: started
    pull: true
    restart_policy: always
    ports:
      - "{{ minio_server_port }}:8081"
    env:
      NEXUS_SECURITY_RANDOMPASSWORD: 'false'
    volumes:
      - "{{ minio_data_dir }}/nexus-data:/nexus-data"
  when: need_nexus | bool